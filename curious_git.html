<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The curious coder’s guide to git &mdash; pydagogue 0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pydagogue 0.2 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">pydagogue 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-curious-coder-s-guide-to-git">
<h1>The curious coder&#8217;s guide to <tt class="docutils literal"><span class="pre">git</span></tt><a class="headerlink" href="#the-curious-coder-s-guide-to-git" title="Permalink to this headline">¶</a></h1>
<div class="section" id="git-love-hate">
<h2>git - love - hate<a class="headerlink" href="#git-love-hate" title="Permalink to this headline">¶</a></h2>
<p>I&#8217;ve used git now for a long time.  I think it&#8217;s a true masterpiece of design,
I use it all day every day and I just can&#8217;t imagine what it would be like not
to use it. So, no question, I <em>love</em> git.</p>
<p>As y&#8217;all may know, <a class="reference external" href="http://git-scm.com/book/en/Getting-Started-A-Short-History-of-Git">Linus Torvalds wrote git from scratch</a>.  He
loves it too.  <a class="reference external" href="http://www.youtube.com/watch?v=MShbP3OpASA#t=2288">Here is Linus talking about git</a> in a question and answer
session:</p>
<blockquote>
<div>Actually I&#8217;m proud of git. I want to say this. The fact that I had to
write git was accidental, but Linux, the design came from a great mind,
and that great mind was not mine. I mean you have to give credit for the
design of Linux to Kernighan and Ritchie and Thompson. I mean there&#8217;s a
reason I like Unix and I wanted to redo it. I do want to say that git is a
design that is mine and unique, and I&#8217;m proud of the fact that I can damn
well also do good design from scratch.</div></blockquote>
<p>But - some people hate git.  Really <em>hate</em> it. They find it confusing and
error prone and it makes them angry.  Why are there such different views?</p>
<p>I think the reason some people hate git, is because they don&#8217;t yet understand
it.  I reason I can say this without being patronizing is because I went
through something similar myself.</p>
<p>When I first started using git, I found it uncomfortable.  I could see it was
very powerful, but I sometimes got lost and stuck and had to Google for a set
of magic commands to get me out of trouble.  I once accidentally made a huge
mess of our project&#8217;s main repository by running a command I didn&#8217;t
understand. Git often made me feel stupid.  It felt like a prototype racecar
with a badly designed dashboard that was just about to blow an engine or a
tire and take me off the road.</p>
<p>Then, one day, I read the <a class="reference external" href="http://tom.preston-werner.com/2009/05/19/the-git-parable.html">git parable</a>.  The git parable is a little story
about a developer trying to work out how to make a version control system.  It
gradually builds up from copying whole directories of files to something very
much like git.  I didn&#8217;t understand it all right away, but as soon as I read
this page, the light-bulb went on - I got git.  I suddenly started to feel
comfortable.  I knew for sure I could work out why git worked the way it did.
I could see that it must be possible how to do complicated and powerful
things, and I could work out how to do them.</p>
<p>Reading the git parable took me about 45 minutes, but those 45 minutes changed
me from an unhappy git user to the man you see before you today, someone who
uses git often every day, but, happily, knowing that I have the right tool for
the job.</p>
<p>So, my experience tells me that to use git - yes <em>use</em> git - you need to spend
that 45 minutes to <em>understand</em> git.  You don&#8217;t believe me, or you think that
I&#8217;m a strange kind of person not like you who probably likes writing their own
operating systems. Not so - the insight I&#8217;m describing comes up over and over.
From <a class="reference external" href="http://www.sbf5.com/~cduan/technical/git">understanding git conceptually</a>:</p>
<blockquote>
<div><p>When I first started using Git, I read plenty of tutorials, as well as the
user manual. Though I picked up the basic usage patterns and commands, I
never felt like I grasped what was going on “under the hood,” so to speak.
Frequently this resulted in cryptic error messages, caused by my random
guessing at the right command to use at a given time. These difficulties
worsened as I began to need more advanced (and less well documented)
features.</p>
<p>When I first started using Git, I read plenty of tutorials, as well as the
user manual. Though I picked up the basic usage patterns and commands, I
never felt like I grasped what was going on “under the hood,” so to speak.
Frequently this resulted in cryptic error messages, caused by my random
guessing at the right command to use at a given time. These difficulties
worsened as I began to need more advanced (and less well documented)
features.</p>
</div></blockquote>
<p>Here&#8217;s a quote from the <a class="reference external" href="http://git-scm.com/book">pro git book</a> by Scott Chacon.
The git book is a standard reference that is hosted on the main git website.</p>
<blockquote>
<div><p>Chapter 9: Git Internals</p>
<p>You may have skipped to this chapter from a previous chapter, or you may
have gotten here after reading the rest of the book — in either case, this
is where you’ll go over the inner workings and implementation of Git. I
found that learning this information was fundamentally important to
understanding how useful and powerful Git is, but others have argued to me
that it can be confusing and unnecessarily complex for beginners. Thus,
I’ve made this discussion the last chapter in the book so you could read
it early or later in your learning process. I leave it up to you to
decide.</p>
</div></blockquote>
<p>So - have no truck with people who try and tell you that you can just use git
and that you don&#8217;t need the <a class="reference external" href="http://rogerdudler.github.io/git-guide">deep shit</a>.  You <em>do</em> need the deep shit, but
the deep shit isn&#8217;t that deep, and it will take you an hour of your time to get
it.  And then I&#8217;m betting that you&#8217;ll see that the alchemist has succeeded at
last, and the shit finally turned into gold.</p>
<p>So - please - invest an hour of your life to understand this stuff.
Concentrate, go slowly, make sure you get it. In return for an hour of your
life, you will get many happy years for which git will appear in its true
form, both beautiful and useful.</p>
</div>
<div class="section" id="the-one-thing-about-git-you-really-need-to-understand">
<h2>The one thing about git you really need to understand<a class="headerlink" href="#the-one-thing-about-git-you-really-need-to-understand" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">git</span></tt> is not really a &#8220;Version Control System&#8221;. It is better described
as a &#8220;Content Management System&#8221;, that turns out to be really good for
version control.</p>
<p>I&#8217;ll say that again.  Git is a content management system.  Or - to quote from
the <a class="reference external" href="http://git-scm.com/docs/git.html">root page of the git manual</a>: &#8220;git -
the stupid content tracker&#8221;.</p>
</div>
<div class="section" id="so-git-is-a-content-manager-so-what">
<h2>So git is a content manager - so what?<a class="headerlink" href="#so-git-is-a-content-manager-so-what" title="Permalink to this headline">¶</a></h2>
<p>To understand why git does what it does, we first need to think about what a
content manager should do, and why we would want one.</p>
<p>As in the <a class="reference external" href="http://tom.preston-werner.com/2009/05/19/the-git-parable.html">git parable</a> - we&#8217;ll try and design our own, and then see what
<tt class="docutils literal"><span class="pre">git</span></tt> has to say.</p>
<p>(To go through this a little more slowly, and with more jokes, you might also
try my  <a class="reference external" href="http://matthew-brett.github.com/pydagogue/foundation.html">git foundations</a> page).</p>
<p>While we are designing our own content management system, we will do a lot of
stuff longhand, to show how things work.  When we get to git, we will find it
these tasks for us.</p>
</div>
<div class="section" id="the-story-so-far">
<h2>The story so far...<a class="headerlink" href="#the-story-so-far" title="Permalink to this headline">¶</a></h2>
<p>You are writing a breakthrough paper showing that you can entirely
explain the brain using random numbers. You&#8217;ve got the draft paper, and
the analysis script and a figure for the paper. These are all in a
directory modestly named <tt class="docutils literal"><span class="pre">nobel_prize</span></tt>.</p>
<p>In this directory, you have the paper draft <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>, the
analysis script <tt class="docutils literal"><span class="pre">very_clever_analysis.py</span></tt>, and a figure for the paper
<tt class="docutils literal"><span class="pre">stunning_figure.png</span></tt>.</p>
<p>You can get this ground-breaking paper by downloading and unzipping
<a class="reference download internal" href="_downloads/nobel_prize_files.zip"><tt class="xref download docutils literal"><span class="pre">nobel_prize_files.zip</span></tt></a>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>unzip -o nobel_prize_files.zip
Archive:  nobel_prize_files.zip
   creating: nobel_prize/
  inflating: nobel_prize/nobel_prize_paper.txt  
  inflating: nobel_prize/stunning_figure.png  
  inflating: nobel_prize/very_clever_analysis.py  
</pre></div>
</div>
<p>Here&#8217;s what we get in our <tt class="docutils literal"><span class="pre">nobel_prize</span></tt> directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls nobel_prize
nobel_prize_paper.txt
stunning_figure.png
very_clever_analysis.py
</pre></div>
</div>
<div class="section" id="the-dog-ate-my-results">
<h3>The dog ate my results<a class="headerlink" href="#the-dog-ate-my-results" title="Permalink to this headline">¶</a></h3>
<p>You&#8217;ve been working on this paper for a while.</p>
<p>About 2 weeks ago, you were very excited with the results. You ran the script,
made the figure, and went to your advisor, Josephine. She was excited too. The
figure looks good! You get ready to publish in Science.</p>
<p>Today you finished cleaning up for the Science paper, and reran the analysis,
and it doesn&#8217;t look that good anymore. You go to see Josephine. She says &#8220;It
used to look better than that&#8221;. That&#8217;s what you think too. But:</p>
<ul class="simple">
<li><strong>Did it really look better before?</strong></li>
<li>If it did, <strong>why does it look different now?</strong></li>
</ul>
</div>
<div class="section" id="deja-vu-all-over-again">
<h3>Deja vu all over again<a class="headerlink" href="#deja-vu-all-over-again" title="Permalink to this headline">¶</a></h3>
<p>Given you are so clever and you have worked out the brain, it&#8217;s really
easy for you to leap in your time machine, and go back two weeks to
start again.</p>
<p>What are you going to do differently this time?</p>
</div>
<div class="section" id="make-regular-snapshots">
<h3>Make regular snapshots<a class="headerlink" href="#make-regular-snapshots" title="Permalink to this headline">¶</a></h3>
<p>You decide to make your own content management system called
<tt class="docutils literal"><span class="pre">fancy_backups</span></tt>.</p>
<p>It&#8217;s very simple.</p>
<p>Every time you finish doing some work on your paper, you make a snapshot
of the analysis directory.</p>
<p>The snapshot is just a copy of all the files in the directory, kept
somewhere safe.</p>
<p>You make a directory to store the snapshots called <tt class="docutils literal"><span class="pre">.fancy_backups</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>nobel_prize
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mkdir .fancy_backups
</pre></div>
</div>
<p>Then you make a directory for the first backup:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mkdir .fancy_backups/1
<span class="nv">$ </span>mkdir .fancy_backups/1/files
</pre></div>
</div>
<p>And you copy the files there:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp * .fancy_backups/1/files
</pre></div>
</div>
</div>
<div class="section" id="reminding-yourself-of-what-you-did">
<h3>Reminding yourself of what you did<a class="headerlink" href="#reminding-yourself-of-what-you-did" title="Permalink to this headline">¶</a></h3>
<p>For good measure, you put a file in the snapshot directory to remind you when
you did the snapshot, and who did it, and what was new for this snapshot. Call
this file <tt class="docutils literal"><span class="pre">info.txt</span></tt>.  So, we write something like this:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/1/info.txt
Date: April 1 2012, 14.30
Author: I. M. Awesome
Notes: First backup of my amazing idea
</pre></div>
</div>
<p>Now you have these files in the <tt class="docutils literal"><span class="pre">nobel_prize</span></tt> directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree -a
.
├── .fancy_backups
│   └── 1
│       ├── files
│       │   ├── nobel_prize_paper.txt
│       │   ├── stunning_figure.png
│       │   └── very_clever_analysis.py
│       └── info.txt
├── nobel_prize_paper.txt
├── stunning_figure.png
└── very_clever_analysis.py

3 directories, 7 files
</pre></div>
</div>
<p>Every time you do some work on the files, you back them up in the same
way. After a few days:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="c"># Append some text to nobel_prize_paper.txt</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;The charts are very impressive&quot;</span> &gt;&gt; nobel_prize_paper.txt
<span class="nv">$ </span><span class="c"># Make a new snapshot</span>
<span class="nv">$ </span>mkdir .fancy_backups/2
<span class="nv">$ </span>mkdir .fancy_backups/2/files
<span class="nv">$ </span>cp * .fancy_backups/2/files
</pre></div>
</div>
<p>We make a new <tt class="docutils literal"><span class="pre">info.txt</span></tt> file describing what is new in this snapshot:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/2/info.txt
Date: April 1 2012, 18.03
Author: I. M. Awesome
Notes: Fruit of enormous thought
</pre></div>
</div>
<p>The next day we write a little more on our paper:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="c"># Append some more text to nobel_prize_paper.txt</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;The graphs are also compelling&quot;</span> &gt;&gt; nobel_prize_paper.txt
<span class="nv">$ </span><span class="c"># Make another shapshot</span>
<span class="nv">$ </span>mkdir .fancy_backups/3
<span class="nv">$ </span>mkdir .fancy_backups/3/files
<span class="nv">$ </span>cp * .fancy_backups/3/files
</pre></div>
</div>
<p>We add a description of these changes:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/3/info.txt
Date: April 2 2012, 11.20
Author: I. M. Awesome
Notes: Now seeing things clearly
</pre></div>
</div>
<p>After three days of work we have three snapshots in our backup directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree -a
.
├── .fancy_backups
│   ├── 1
│   │   ├── files
│   │   │   ├── nobel_prize_paper.txt
│   │   │   ├── stunning_figure.png
│   │   │   └── very_clever_analysis.py
│   │   └── info.txt
│   ├── 2
│   │   ├── files
│   │   │   ├── nobel_prize_paper.txt
│   │   │   ├── stunning_figure.png
│   │   │   └── very_clever_analysis.py
│   │   └── info.txt
│   └── 3
│       ├── files
│       │   ├── nobel_prize_paper.txt
│       │   ├── stunning_figure.png
│       │   └── very_clever_analysis.py
│       └── info.txt
├── nobel_prize_paper.txt
├── stunning_figure.png
└── very_clever_analysis.py

7 directories, 15 files
</pre></div>
</div>
<p>You keep doing this for another couple of days, until again the time comes to
talk to Josephine. By now you have 5 snapshots.</p>
<p>The future has not changed. Josephine again thinks the results have
changed. But now - you can check.</p>
<p>You go back and look at <tt class="docutils literal"><span class="pre">.fancy_backups/1/stunning_figure.png</span></tt>. It
does look different.</p>
<p>You go through all the <tt class="docutils literal"><span class="pre">.fancy_backups</span></tt> directories in order. It turns
out that the figure changes in <tt class="docutils literal"><span class="pre">.fancy_backups/4</span></tt>.</p>
<p>You look in <tt class="docutils literal"><span class="pre">.fancy_backups/4/info.txt</span></tt> and it says:</p>
<div class="highlight-python"><div class="highlight"><pre>Date: April 4 2012, 01.40
Author: I. M. Awesome
Notes: I always get the best ideas after I have been drinking.
</pre></div>
</div>
<p>Aha. Then you go find the problem in
<tt class="docutils literal"><span class="pre">fancy_backups/4/very_clever_analysis.py</span></tt>.</p>
<p>You fix <tt class="docutils literal"><span class="pre">very_clever_analysis.py</span></tt>.</p>
<p>You make a new snapshot <tt class="docutils literal"><span class="pre">.fancy_backups/6</span></tt>.</p>
<p>Back on track for a scientific breakthrough</p>
</div>
<div class="section" id="terminology-breakout">
<h3>Terminology breakout<a class="headerlink" href="#terminology-breakout" title="Permalink to this headline">¶</a></h3>
<p>Here are some
<a class="reference external" href="https://www.kernel.org/pub/software/scm/git/docs/gitglossary.html">terms</a>.</p>
<dl class="docutils">
<dt>Working tree</dt>
<dd>The files you are working on in the current directory (<tt class="docutils literal"><span class="pre">nobel_prize</span></tt>).
The files <tt class="docutils literal"><span class="pre">very_clever_analysis.py</span></tt>, <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>,
<tt class="docutils literal"><span class="pre">stunning_figure.png</span></tt> are the files in your working tree.</dd>
<dt>Repository</dt>
<dd>The directory containing information about the history of the files. Your
directory <tt class="docutils literal"><span class="pre">.fancy_snapshot</span></tt> is the repository.</dd>
<dt>Commit</dt>
<dd>A completed snapshot. For example, <tt class="docutils literal"><span class="pre">.fancy_backups/1</span></tt> contains one
commit.</dd>
</dl>
<p>We&#8217;ll use these terms to get used to them.</p>
</div>
<div class="section" id="breaking-up-work-into-chunks">
<h3>Breaking up work into chunks<a class="headerlink" href="#breaking-up-work-into-chunks" title="Permalink to this headline">¶</a></h3>
<p>You did some edits to the paper <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt> to edit the
introduction.</p>
<p>You also had a good idea for the analysis, and did some edits to
<tt class="docutils literal"><span class="pre">very_clever_analysis.py</span></tt>.</p>
<p>You&#8217;ve got used to breaking each new <em>commit</em> (snapshot) up into little
bits of extra work, with their own comments in the <tt class="docutils literal"><span class="pre">info.txt</span></tt>.</p>
<p>You want to make two commits from your changes:</p>
<ol class="arabic simple">
<li>a commit containing the changes to <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>, with comment
&#8220;Changes to introduction&#8221;;</li>
<li>Another commit containing the changes to <tt class="docutils literal"><span class="pre">very_clever_analysis.py</span></tt>
with comment &#8220;Crazy new analysis&#8221;</li>
</ol>
<p>How can I do that?</p>
</div>
<div class="section" id="the-staging-area">
<h3>The staging area<a class="headerlink" href="#the-staging-area" title="Permalink to this headline">¶</a></h3>
<p>You adapt the workflow. Each time you do a commit, you copy the contents of
the commit to directory <tt class="docutils literal"><span class="pre">.fancy_backups/staging_area</span></tt>. That will be the
default contents of your next commit.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mkdir .fancy_backups/staging_area
<span class="nv">$ </span>cp .fancy_backups/6/files/* .fancy_backups/staging_area
<span class="nv">$ </span>ls .fancy_backups/staging_area
nobel_prize_paper.txt
stunning_figure.png
very_clever_analysis.py
</pre></div>
</div>
<p>Now, you do your edits to <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>, and
<tt class="docutils literal"><span class="pre">very_clever_analysis.py</span></tt> in your <em>working tree</em> (the <tt class="docutils literal"><span class="pre">nobel_prize</span></tt>
directory). You want to make a new commit containing the changes to the paper
but not the changes to the script.  You get ready for the next commit with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp nobel_prize_paper.txt .fancy_backups/staging_area
</pre></div>
</div>
<p>The staging area now contains all the files for the upcoming commit
(snapshot). The upcoming commit only has the changes in the paper.</p>
<p>You make the commit by making the usual directories, and copying the contents
of the staging area into the commit <tt class="docutils literal"><span class="pre">files</span></tt> directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="c"># Make commit directories</span>
<span class="nv">$ </span>mkdir .fancy_backups/7
<span class="nv">$ </span>mkdir .fancy_backups/7/files
<span class="nv">$ </span><span class="c"># Copy contents of staging area into commit directory</span>
<span class="nv">$ </span>cp .fancy_backups/staging_area/* .fancy_backups/7/files
</pre></div>
</div>
<p>with message:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/7/info.txt
Date: April 10 2012, 14.30
Author: I. M. Awesome
Notes: Changes to introduction
</pre></div>
</div>
<p>After we have done the commit this way, by coping the staging area to the
commit <tt class="docutils literal"><span class="pre">files</span></tt> directory, the staging area is identical to the contents of
the commit.  Now you are ready for the next commit, that adds the changes to
the analysis script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp very_clever_analysis.py .fancy_backups/staging_area
</pre></div>
</div>
<p>The commit is now <em>staged</em> and ready to be saved.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="c"># Our commit procedure; same as last time with &quot;8&quot; instead of &quot;7&quot;</span>
<span class="nv">$ </span>mkdir .fancy_backups/8
<span class="nv">$ </span>mkdir .fancy_backups/8/files
<span class="nv">$ </span>cp .fancy_backups/staging_area/* .fancy_backups/8/files
</pre></div>
</div>
<p>The message is:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/8/info.txt
Date: April 10 2012, 14.35
Author: I. M. Awesome
Notes: Crazy new analysis
</pre></div>
</div>
<p>Here is what you have in your <tt class="docutils literal"><span class="pre">.fancy_backups</span></tt> directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree -a .fancy_backups
.fancy_backups
├── 1
│   ├── files
│   │   ├── nobel_prize_paper.txt
│   │   ├── stunning_figure.png
│   │   └── very_clever_analysis.py
│   └── info.txt
├── 2
│   ├── files
│   │   ├── nobel_prize_paper.txt
│   │   ├── stunning_figure.png
│   │   └── very_clever_analysis.py
│   └── info.txt
├── 3
│   ├── files
│   │   ├── nobel_prize_paper.txt
│   │   ├── stunning_figure.png
│   │   └── very_clever_analysis.py
│   └── info.txt
├── 4
│   ├── files
│   │   ├── nobel_prize_paper.txt
│   │   ├── stunning_figure.png
│   │   └── very_clever_analysis.py
│   └── info.txt
├── 5
│   ├── files
│   │   ├── nobel_prize_paper.txt
│   │   ├── stunning_figure.png
│   │   └── very_clever_analysis.py
│   └── info.txt
├── 6
│   ├── files
│   │   ├── nobel_prize_paper.txt
│   │   ├── stunning_figure.png
│   │   └── very_clever_analysis.py
│   └── info.txt
├── 7
│   ├── files
│   │   ├── nobel_prize_paper.txt
│   │   ├── stunning_figure.png
│   │   └── very_clever_analysis.py
│   └── info.txt
├── 8
│   ├── files
│   │   ├── nobel_prize_paper.txt
│   │   ├── stunning_figure.png
│   │   └── very_clever_analysis.py
│   └── info.txt
└── staging_area
    ├── nobel_prize_paper.txt
    ├── stunning_figure.png
    └── very_clever_analysis.py

17 directories, 35 files
</pre></div>
</div>
</div>
<div class="section" id="now-the-very-difficult-problem">
<h3>Now the very difficult problem<a class="headerlink" href="#now-the-very-difficult-problem" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s say that the figure <tt class="docutils literal"><span class="pre">stunning_figure.png</span></tt> is large.</p>
<p>Let&#8217;s say it changes only once across our 8 commits, at commit 5.</p>
<p>What should we do to save disk space for <tt class="docutils literal"><span class="pre">.fancy_backups</span></tt>?</p>
</div>
</div>
<div class="section" id="cryptographic-hashes-might-be-useful">
<h2>Cryptographic hashes might be useful<a class="headerlink" href="#cryptographic-hashes-might-be-useful" title="Permalink to this headline">¶</a></h2>
<p>This section describes &#8220;Crytographic hashes&#8221;. These are the key to an
excellent way to store our snapshots.  Later we will see that they are central
to the way that git works.</p>
<p>See : <a class="reference external" href="http://en.wikipedia.org/wiki/Cryptographic_hash_function">Wikipedia on hash
functions</a>.</p>
<p>A <em>hash</em> is the result of running a <em>hash function</em> over a block of
data. The hash is a fixed length string that is the <em>signature</em> of that
exact block of data.  One common hash function is called SHA1.  Let&#8217;s run this
via the command line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="c"># Make a file with a single line of text</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;git is a rude word in UK English&quot;</span> &gt; git_is_rude
<span class="nv">$ </span><span class="c"># Show the SHA1 hash</span>
<span class="nv">$ </span>shasum git_is_rude
30ad6c360a692c1fe66335bb00d00e0528346be5  git_is_rude
</pre></div>
</div>
<p>Not too exciting so far. However, the rather magical nature of this string is
not yet apparent. This SHA1 hash is a <em>cryptographic</em> hash because</p>
<ul class="simple">
<li>the hash value is (almost) unique to this exact file contents, and</li>
<li>it is (almost) impossible to find some other file contents with the same
hash</li>
</ul>
<p>In other words, there is no practical way for you to find another file with
different contents that will give the same hash.</p>
<p>For example, a tiny change in the string makes the hash completely different.
Here I&#8217;ve just added a full stop at the end:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;git is a rude word in UK English.&quot;</span> &gt; git_is_rude_stop
<span class="nv">$ </span>shasum git_is_rude_stop
23d97b00299c250b43049be67c97cf2e5ffc2428  git_is_rude_stop
</pre></div>
</div>
<p>So, if you give me some data, and I calculate the SHA1 hash value, and it
comes out as <tt class="docutils literal"><span class="pre">30ad6c360a692c1fe66335bb00d00e0528346be5</span></tt>, then I can be very
sure that the data you gave me was exactly the ASCII string &#8220;git is a rude
word in UK English&#8221;.</p>
<div class="section" id="a-crazy-idea-use-hash-values-as-file-names">
<h3>A crazy idea - use hash values as file names<a class="headerlink" href="#a-crazy-idea-use-hash-values-as-file-names" title="Permalink to this headline">¶</a></h3>
<p>Make a new directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mkdir .fancy_backups/objects
</pre></div>
</div>
<p>Calculate the hash value for the figure:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>shasum .fancy_backups/1/files/stunning_figure.png
aff88ecead2c7166770969a54dc855c8b91be864  .fancy_backups/1/files/stunning_figure.png
</pre></div>
</div>
<p>Save the figure with the hash value as the file name:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp .fancy_backups/1/files/stunning_figure.png .fancy_backups/objects/aff88ecead2c7166770969a54dc855c8b91be864
</pre></div>
</div>
<p>Do the same for the other two files in the first commit.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>shasum .fancy_backups/1/files/nobel_prize_paper.txt
<span class="nv">$ </span>shasum .fancy_backups/1/files/very_clever_analysis.py
3af8809ecb9c6dec33fc7e5ad330e384663f5a0d  .fancy_backups/1/files/nobel_prize_paper.txt
e7f3ca9157fd7088b6a927a618e18d4bc4712fb6  .fancy_backups/1/files/very_clever_analysis.py
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp .fancy_backups/1/files/nobel_prize_paper.txt .fancy_backups/objects/3af8809ecb9c6dec33fc7e5ad330e384663f5a0d
<span class="nv">$ </span>cp .fancy_backups/1/files/very_clever_analysis.py .fancy_backups/objects/e7f3ca9157fd7088b6a927a618e18d4bc4712fb6
</pre></div>
</div>
<p>We now have three new files in <tt class="docutils literal"><span class="pre">.fancy_backups/objects</span></tt>, one corresponding
to each unique file <em>contents</em> we have hashed:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree -a .fancy_backups/objects
.fancy_backups/objects
├── 3af8809ecb9c6dec33fc7e5ad330e384663f5a0d
├── aff88ecead2c7166770969a54dc855c8b91be864
└── e7f3ca9157fd7088b6a927a618e18d4bc4712fb6

0 directories, 3 files
</pre></div>
</div>
</div>
<div class="section" id="making-the-directory-listing">
<h3>Making the directory listing<a class="headerlink" href="#making-the-directory-listing" title="Permalink to this headline">¶</a></h3>
<p>The snapshot has three files.  We can think of the file has having <em>content</em>
(the bytes contained in the file) and a <em>filename</em>.  We have already stored
the contents in the object directory, but with a different filename, from the
hash of the contents.  To record the filenames, we need to make a directory
listing.</p>
<p>To do this, we can point the snapshot to the hash filename versions of the
files by making a <em>text directory listing</em> or <em>tree</em> listing:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/1/directory_list
Filename                Hash value
========                ==========
nobel_prize_paper.txt   3af8809ecb9c6dec33fc7e5ad330e384663f5a0d
stunning_figure.png     aff88ecead2c7166770969a54dc855c8b91be864
very_clever_analysis.py e7f3ca9157fd7088b6a927a618e18d4bc4712fb6
</pre></div>
</div>
</div>
<div class="section" id="the-next-commit-saves-space">
<h3>The next commit - saves space!<a class="headerlink" href="#the-next-commit-saves-space" title="Permalink to this headline">¶</a></h3>
<p>Now we work on the files from the second commit. These are the files in
<tt class="docutils literal"><span class="pre">.fancy_backups/2/files</span></tt>.</p>
<p>Remember that we only changed <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt> in this commit.</p>
<p>Do we need to copy <tt class="docutils literal"><span class="pre">nobel_prize_papar.txt</span></tt> or <tt class="docutils literal"><span class="pre">stunning_figure.png</span></tt> to the
objects directory again?</p>
<p>No - because they have not changed.  Because they have not changed, their hash
values have not changed.  Because their hash values have not changed, and
because the hash values are unique to the contents, we already have the files
we need in the <tt class="docutils literal"><span class="pre">objects</span></tt> directory.</p>
<p>Specifically, because <tt class="docutils literal"><span class="pre">.fancy_backups/2/stunning_figure.png</span></tt> is the same as
<tt class="docutils literal"><span class="pre">.fancy_backups/1/stunning_figure.png</span></tt> we know that the hash is the same,
and the hash is the one we&#8217;ve already calculated,
<tt class="docutils literal"><span class="pre">aff88ecead2c7166770969a54dc855c8b91be864</span></tt>.  We already have a file
<tt class="docutils literal"><span class="pre">.fancy_backups/objects/aff88ecead2c7166770969a54dc855c8b91be864</span></tt>, and we
know, because the hash values are unique, that this file must contain the
exact contents of <tt class="docutils literal"><span class="pre">.fancy_backups/1/stunning_figure.png</span></tt>, which is also the
exact contents of <tt class="docutils literal"><span class="pre">.fancy_backups/2/stunning_figure.png</span></tt>.</p>
<p>So in general, if we do a hash on a file, and then we find a filename the same
as this hash in the objects directory, we already have that exact contents
backed up, and we don&#8217;t need to do a copy.</p>
<p>Here are the hashes for the files in commit 2:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>shasum .fancy_backups/2/files/nobel_prize_paper.txt
<span class="nv">$ </span>shasum .fancy_backups/2/files/stunning_figure.png
<span class="nv">$ </span>shasum .fancy_backups/2/files/very_clever_analysis.py
90aa1015732676bf63d2d950714a1f11196875fc  .fancy_backups/2/files/nobel_prize_paper.txt
aff88ecead2c7166770969a54dc855c8b91be864  .fancy_backups/2/files/stunning_figure.png
e7f3ca9157fd7088b6a927a618e18d4bc4712fb6  .fancy_backups/2/files/very_clever_analysis.py
</pre></div>
</div>
<p>We already have files <tt class="docutils literal"><span class="pre">aff88ecead2c7166770969a54dc855c8b91be864</span></tt> and
<tt class="docutils literal"><span class="pre">e7f3ca9157fd7088b6a927a618e18d4bc4712fb6</span></tt> in <tt class="docutils literal"><span class="pre">.fancy_backups/objects</span></tt>, so
the only file we need to copy is <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp .fancy_backups/2/files/nobel_prize_paper.txt .fancy_backups/objects/90aa1015732676bf63d2d950714a1f11196875fc
</pre></div>
</div>
<p>Here then is our directory listing for commit 2:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/2/directory_list
Filename                Hash value
========                ==========
nobel_prize_paper.txt   90aa1015732676bf63d2d950714a1f11196875fc
stunning_figure.png     aff88ecead2c7166770969a54dc855c8b91be864
very_clever_analysis.py e7f3ca9157fd7088b6a927a618e18d4bc4712fb6
</pre></div>
</div>
</div>
<div class="section" id="an-even-more-crazy-idea-hash-the-directory-list">
<h3>An even more crazy idea - hash the directory list<a class="headerlink" href="#an-even-more-crazy-idea-hash-the-directory-list" title="Permalink to this headline">¶</a></h3>
<p>The directory listing is just a text file.  We can store the directory listing
as we store the other files, by writing an object file with the file hash:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>shasum .fancy_backups/1/directory_list
b7c9cd682e7d4bf28b82e76fb2276608f49e16d5  .fancy_backups/1/directory_list
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp .fancy_backups/1/directory_list .fancy_backups/objects/b7c9cd682e7d4bf28b82e76fb2276608f49e16d5
</pre></div>
</div>
<p>And we can do the same for the second commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>shasum .fancy_backups/2/directory_list
4f379c649a596d2f9cc2cf5b91f4a67a3101b65e  .fancy_backups/2/directory_list
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp .fancy_backups/2/directory_list .fancy_backups/objects/4f379c649a596d2f9cc2cf5b91f4a67a3101b65e
</pre></div>
</div>
<p>Now - would I get the same hash for the directory listing if I had had a
different figure?</p>
</div>
<div class="section" id="even-more-crazy-idea-make-the-whole-commit-into-a-text-file">
<h3>Even more crazy idea - make the whole commit into a text file<a class="headerlink" href="#even-more-crazy-idea-make-the-whole-commit-into-a-text-file" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;ve seen that we can make a directory listing that is unique for the whole
contents of the snapshot files (file contents and file names).  Therefore the
<em>hash</em> of the directory listing is also unique for the contents of the
snapshot files.  So, we can make a <em>commit file</em> that is the <tt class="docutils literal"><span class="pre">info.txt</span></tt> file
above, but now with the hash of the directory listing included.  Including the
directory listing means that this <em>commit file</em> is now also unique to the
contents of the snapshot.  The commit file for the first commit might look
something like this:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/1/commit
Date: April 1 2012, 14.30
Author: I. M. Awesome
Notes: First backup of my amazing idea
Tree: b7c9cd682e7d4bf28b82e76fb2276608f49e16d5
</pre></div>
</div>
<p>The commit file for the second commit might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/2/commit
Date: April 1 2012, 18.03
Author: I. M. Awesome
Notes: Fruit of enormous thought
Tree: 4f379c649a596d2f9cc2cf5b91f4a67a3101b65e
</pre></div>
</div>
<p>The commit is now just a text file, and I can hash this too:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>shasum .fancy_backups/1/commit
<span class="nv">$ </span>shasum .fancy_backups/2/commit
012ad9f6c3a715516514e8821a71d891c4211f8f  .fancy_backups/1/commit
d4c297c8b0c768647e0b3faa9308a40d0e3cb4ba  .fancy_backups/2/commit
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp .fancy_backups/1/commit .fancy_backups/objects/012ad9f6c3a715516514e8821a71d891c4211f8f
<span class="nv">$ </span>cp .fancy_backups/2/commit .fancy_backups/objects/d4c297c8b0c768647e0b3faa9308a40d0e3cb4ba
</pre></div>
</div>
<p>Would the commit hash value change if the figure changed?</p>
</div>
<div class="section" id="so-crazy-it-s-actually-git">
<h3>So crazy it&#8217;s actually git<a class="headerlink" href="#so-crazy-it-s-actually-git" title="Permalink to this headline">¶</a></h3>
<p>Now look in <tt class="docutils literal"><span class="pre">.fancy_backups/objects</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree -a .fancy_backups/objects
.fancy_backups/objects
├── 012ad9f6c3a715516514e8821a71d891c4211f8f
├── 3af8809ecb9c6dec33fc7e5ad330e384663f5a0d
├── 4f379c649a596d2f9cc2cf5b91f4a67a3101b65e
├── 90aa1015732676bf63d2d950714a1f11196875fc
├── aff88ecead2c7166770969a54dc855c8b91be864
├── b7c9cd682e7d4bf28b82e76fb2276608f49e16d5
├── d4c297c8b0c768647e0b3faa9308a40d0e3cb4ba
└── e7f3ca9157fd7088b6a927a618e18d4bc4712fb6

0 directories, 8 files
</pre></div>
</div>
<p>That&#8217;s 3 file copies for the files from the first commit, 1 file copy from the
second commit, 2 directory listings (for first and second commit) and two
commit listings (for the first and second commit) = 8 hash objects.</p>
</div>
<div class="section" id="linking-the-commits">
<h3>Linking the commits<a class="headerlink" href="#linking-the-commits" title="Permalink to this headline">¶</a></h3>
<div class="section" id="can-we-completely-get-rid-of-fancy-backups-1-fancy-backups-2">
<h4>Can we completely get rid of <tt class="docutils literal"><span class="pre">.fancy_backups/1</span></tt>, <tt class="docutils literal"><span class="pre">.fancy_backups/2</span></tt><a class="headerlink" href="#can-we-completely-get-rid-of-fancy-backups-1-fancy-backups-2" title="Permalink to this headline">¶</a></h4>
<p>The reason for our commit names &#8220;1&#8221;,&#8221;2&#8221;, &#8220;3&#8221; was so we know that commit &#8220;2&#8221;
comes after commit &#8220;1&#8221; and before commit &#8220;3&#8221;. Now our commits have filenames
with arbitrary hashes, we can&#8217;t tell the order from the name.</p>
<p>However, the commit hash does uniquely identify the commit.  For example, we
know that the file beginning &#8216;012ad9f&#8217; <em>completely defines the first commit</em>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .fancy_backups/objects/012ad9f6c3a715516514e8821a71d891c4211f8f
Date: April 1 2012, 14.30
Author: I. M. Awesome
Notes: First backup of my amazing idea
Tree: b7c9cd682e7d4bf28b82e76fb2276608f49e16d5
</pre></div>
</div>
<p>We can specify the order by adding the commit hash of the previous
(parent) commit into the current commit:</p>
<div class="highlight-python"><div class="highlight"><pre># file: .fancy_backups/2/info.txt
Date: April 1 2012, 18.03
Author: I. M. Awesome
Notes: Fruit of enormous thought
Tree: 1dca3837b1076cdcfb02e86018377725e5d0e86e
Parent: 012ad9f6c3a715516514e8821a71d891c4211f8f
</pre></div>
</div>
<p>Now we have the order of the commits from the links between them, where the
links are given by the hash value in the <tt class="docutils literal"><span class="pre">Parent</span></tt> field.</p>
<p>And now you are already a git master.</p>
<div class="section" id="gitting-going-sorry">
<h5>Gitting going (sorry)<a class="headerlink" href="#gitting-going-sorry" title="Permalink to this headline">¶</a></h5>
<p><strong>Note</strong>: Much of the rest of this presentation comes from Fernando
Perez&#8217; excellent git tutorial in his <a class="reference external" href="https://github.com/fperez/reprosw">reproducible software
repository</a>. Thanks to Fernando
for sharing.</p>
<p>We need to tell git about us before we start. This stuff will go into
the commit information.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git config --global user.name <span class="s2">&quot;Matthew Brett&quot;</span>
<span class="nv">$ </span>git config --global user.email <span class="s2">&quot;matthew.brett@gmail.com&quot;</span>
</pre></div>
</div>
<p>git often needs to call up a text editor. Choose the editor you like here:</p>
<div class="highlight-python"><div class="highlight"><pre># Put here your preferred editor
# gedit is a reasonable choice for Linux
git config --global core.editor gedit
</pre></div>
</div>
<p>We also turn on the use of color, which is very helpful in making the
output of git easier to read:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git config --global color.ui <span class="s2">&quot;auto&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="getting-help">
<h3>Getting help<a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git
usage: git <span class="o">[</span>--version<span class="o">]</span> <span class="o">[</span>--help<span class="o">]</span> <span class="o">[</span>-C &lt;path&gt;<span class="o">]</span> <span class="o">[</span>-c <span class="nv">name</span><span class="o">=</span>value<span class="o">]</span>
           <span class="o">[</span>--exec-path<span class="o">[=</span>&lt;path&gt;<span class="o">]]</span> <span class="o">[</span>--html-path<span class="o">]</span> <span class="o">[</span>--man-path<span class="o">]</span> <span class="o">[</span>--info-path<span class="o">]</span>
           <span class="o">[</span>-p|--paginate|--no-pager<span class="o">]</span> <span class="o">[</span>--no-replace-objects<span class="o">]</span> <span class="o">[</span>--bare<span class="o">]</span>
           <span class="o">[</span>--git-dir<span class="o">=</span>&lt;path&gt;<span class="o">]</span> <span class="o">[</span>--work-tree<span class="o">=</span>&lt;path&gt;<span class="o">]</span> <span class="o">[</span>--namespace<span class="o">=</span>&lt;name&gt;<span class="o">]</span>
           &lt;<span class="nb">command</span>&gt; <span class="o">[</span>&lt;args&gt;<span class="o">]</span>

The most commonly used git commands are:
   add        Add file contents to the index
   bisect     Find by binary search the change that introduced a bug
   branch     List, create, or delete branches
   checkout   Checkout a branch or paths to the working tree
   clone      Clone a repository into a new directory
   commit     Record changes to the repository
   diff       Show changes between commits, commit and working tree, etc
   fetch      Download objects and refs from another repository
   grep       Print lines matching a pattern
   init       Create an empty Git repository or reinitialize an existing one
   log        Show commit logs
   merge      Join two or more development histories together
   mv         Move or rename a file, a directory, or a symlink
   pull       Fetch from and integrate with another repository or a <span class="nb">local </span>branch
   push       Update remote refs along with associated objects
   rebase     Forward-port <span class="nb">local </span>commits to the updated upstream head
   reset      Reset current HEAD to the specified state
   rm         Remove files from the working tree and from the index
   show       Show various types of objects
   status     Show the working tree status
   tag        Create, list, delete or verify a tag object signed with GPG

<span class="s1">&#39;git help -a&#39;</span> and <span class="s1">&#39;git help -g&#39;</span> lists available subcommands and some
concept guides. See <span class="s1">&#39;git help &lt;command&gt;&#39;</span> or <span class="s1">&#39;git help &lt;concept&gt;&#39;</span>
to <span class="nb">read </span>about a specific subcommand or concept.
</pre></div>
</div>
<p>Try <tt class="docutils literal"><span class="pre">git</span> <span class="pre">help</span> <span class="pre">add</span></tt> for an example.</p>
</div>
<div class="section" id="initializing-the-repository">
<h3>Initializing the repository<a class="headerlink" href="#initializing-the-repository" title="Permalink to this headline">¶</a></h3>
<p>We first set this <tt class="docutils literal"><span class="pre">nobel_prize</span></tt> directory be version controlled with
git.  We start with the original files for the paper:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>unzip -o nobel_prize_files.zip
<span class="nv">$ </span><span class="nb">cd </span>nobel_prize
Archive:  nobel_prize_files.zip
  inflating: nobel_prize/nobel_prize_paper.txt  
  inflating: nobel_prize/stunning_figure.png  
  inflating: nobel_prize/very_clever_analysis.py  
</pre></div>
</div>
<p>Create git repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git init
Initialized empty Git repository in /Users/mb312/dev_trees/pydagogue/nobel_prize/.git/
</pre></div>
</div>
<p>What happened when we did <tt class="docutils literal"><span class="pre">git</span> <span class="pre">init</span></tt>? Just what we were expecting; we have a
new <em>repository</em> directory called <tt class="docutils literal"><span class="pre">.git</span></tt></p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls .git
HEAD
branches
config
description
hooks
info
objects
refs
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">objects</span></tt> directory looks familiar. What&#8217;s in there?</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree .git/objects
.git/objects
├── info
└── pack

2 directories, 0 files
</pre></div>
</div>
<p>Nothing but a couple of empty directories. That makes sense.</p>
</div>
<div class="section" id="git-add-put-stuff-into-the-staging-area">
<h3>git add - put stuff into the staging area<a class="headerlink" href="#git-add-put-stuff-into-the-staging-area" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git add nobel_prize_paper.txt
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree .git/objects
.git/objects
├── d9
│   └── 2d079af6a7f276cc8d63dcf2549c03e7deb553
├── info
└── pack

3 directories, 1 file
</pre></div>
</div>
<p>Doing <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">nobel_prize_paper.txt</span></tt> has added a file to the
<tt class="docutils literal"><span class="pre">.git/objects</span></tt> directory. That filename looks suspiciously like a
hash.</p>
<p>We expect that <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></tt> added the file to the <em>staging area</em>.  We will need
to use a command <tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt> to check that, and that will come soon.</p>
</div>
<div class="section" id="looking-at-real-git-objects">
<h3>Looking at real git objects<a class="headerlink" href="#looking-at-real-git-objects" title="Permalink to this headline">¶</a></h3>
<p>Git objects are nearly as simple as the objects we were writing in
<tt class="docutils literal"><span class="pre">.fancy_backups</span></tt>.</p>
<p>The main difference is that, to save space, they are compressed, in fact
using a library called <tt class="docutils literal"><span class="pre">zlib</span></tt>.</p>
<p>These objects are so simple that it&#8217;s very easy to write small code snippets
to read them - see <a class="reference internal" href="reading_git_objects.html"><em>Reading git objects</em></a>.</p>
<p>Git will also show the contents of objects with the command <tt class="docutils literal"><span class="pre">git</span> <span class="pre">cat-file</span>
<span class="pre">-p</span></tt>.</p>
<p>When we did <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">nobel_prize_paper.txt</span></tt>, we got a new file in
<tt class="docutils literal"><span class="pre">.git/objects</span></tt>, with filename <tt class="docutils literal"><span class="pre">d9/2d079af6a7f276cc8d63dcf2549c03e7deb553</span></tt>.
The filename is in fact a hash, where the first two digits form the directory
name (<tt class="docutils literal"><span class="pre">d9</span></tt>) and the rest of the filename is the rest of the hash digits
<a class="footnote-reference" href="#git-object-dir" id="id1">[1]</a>.</p>
<p>Here&#8217;s the contents of the object:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git cat-file -p d92d079af6a7f276cc8d63dcf2549c03e7deb553
The brain is just a <span class="nb">set </span>of random <span class="nv">numbers</span>
<span class="o">=========================================</span>

We have discovered that the brain is a <span class="nb">set </span>of random numbers.

We have charts and graphs to back us up.
</pre></div>
</div>
<p>Just as we expected, it is the current contents of the
<tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>.</p>
<p>In fact we only need to give git enough hash digits for git to uniquely
identify the object.  7 digits is often enough, as in:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git cat-file -p d92d079
The brain is just a <span class="nb">set </span>of random <span class="nv">numbers</span>
<span class="o">=========================================</span>

We have discovered that the brain is a <span class="nb">set </span>of random numbers.

We have charts and graphs to back us up.
</pre></div>
</div>
</div>
<div class="section" id="git-status-showing-the-status-of-files-in-the-working-tree">
<h3>git status - showing the status of files in the working tree<a class="headerlink" href="#git-status-showing-the-status-of-files-in-the-working-tree" title="Permalink to this headline">¶</a></h3>
<p>The working tree is the <tt class="docutils literal"><span class="pre">nobel_prize</span></tt> directory.  It now contains a
repository – the <tt class="docutils literal"><span class="pre">.git</span></tt> directory.</p>
<p><tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt> tells us about the relationship of the files in the working
tree to the repository.</p>
<p>We have done a <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></tt> on <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>, and that added the
file to the staging area.  We can see that with <tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git status
On branch master

Initial commit

Changes to be committed:
  <span class="o">(</span>use <span class="s2">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>

	new file:   nobel_prize_paper.txt

Untracked files:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to include in what will be committed<span class="o">)</span>

	stunning_figure.png
	very_clever_analysis.py
</pre></div>
</div>
<p>Sure enough, the output tells that &#8220;new file: nobel_prize_paper.txt&#8221; is in the
&#8220;changes to be committed&#8221;.  It also tells us that the other two files –
<tt class="docutils literal"><span class="pre">stunning_figure.png</span></tt> and <tt class="docutils literal"><span class="pre">very_clever_analysis.py</span></tt> – are &#8220;untracked&#8221;.</p>
<p>An untracked file is a file with a filename that has never been added to the
repo with <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></tt>.  Until you <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></tt> an untracked file, git will
ignore these files and assume you don&#8217;t want to keep track of them.</p>
</div>
<div class="section" id="staging-the-other-files">
<h3>Staging the other files<a class="headerlink" href="#staging-the-other-files" title="Permalink to this headline">¶</a></h3>
<p>We do want to keep track of the other files, so we stage them:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git add stunning_figure.png
<span class="nv">$ </span>git add very_clever_analysis.py
<span class="nv">$ </span>git status
On branch master

Initial commit

Changes to be committed:
  <span class="o">(</span>use <span class="s2">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>

	new file:   nobel_prize_paper.txt
	new file:   stunning_figure.png
	new file:   very_clever_analysis.py
</pre></div>
</div>
<p>We have now staged all three of our files.  We have three objects in
<tt class="docutils literal"><span class="pre">.git/objects</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree .git/objects
.git/objects
├── 8a
│   └── dc8bf371d669242ea998f78f9916867cc6203c
├── 9f
│   └── fc311b29f0c87bf502b92df951d90ef88c1c7d
├── d9
│   └── 2d079af6a7f276cc8d63dcf2549c03e7deb553
├── info
└── pack

5 directories, 3 files
</pre></div>
</div>
</div>
<div class="section" id="git-commit-making-the-snapshot">
<h3>git commit - making the snapshot<a class="headerlink" href="#git-commit-making-the-snapshot" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git commit -m <span class="s2">&quot;First backup of my amazing idea&quot;</span>
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 96286d8<span class="o">]</span> First backup of my amazing idea
 3 files changed, 12 insertions<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 nobel_prize_paper.txt
 create mode 100644 stunning_figure.png
 create mode 100644 very_clever_analysis.py
</pre></div>
</div>
<p>In the line above, we used the <tt class="docutils literal"><span class="pre">-m</span></tt> flag to specify a message at the
command line. If we don&#8217;t do that, git will open the editor we specified
in our configuration above and require that we enter a message. By
default, git refuses to record changes that don&#8217;t have a message to go
along with them (though you can obviously &#8216;cheat&#8217; by using an empty or
meaningless string: git only tries to facilitate best practices, it&#8217;s
not your nanny).</p>
<p>We are now expecting to have two new <tt class="docutils literal"><span class="pre">.git/object</span></tt> files, for the directory
tree, and for the commit.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree .git/objects
.git/objects
├── 8a
│   └── dc8bf371d669242ea998f78f9916867cc6203c
├── 96
│   └── 286d8b40ba9438557dd3d8af5fea6f02a4fb52
├── 9f
│   └── fc311b29f0c87bf502b92df951d90ef88c1c7d
├── d9
│   └── 2d079af6a7f276cc8d63dcf2549c03e7deb553
├── e1
│   └── 298063f6f94851ae551a292ac91ca84029c0e8
├── info
└── pack

7 directories, 5 files
</pre></div>
</div>
<p>Here&#8217;s the contents of the tree object (directory listing):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git cat-file -p e129806
100644 blob d92d079af6a7f276cc8d63dcf2549c03e7deb553	nobel_prize_paper.txt
100644 blob 9ffc311b29f0c87bf502b92df951d90ef88c1c7d	stunning_figure.png
100644 blob 8adc8bf371d669242ea998f78f9916867cc6203c	very_clever_analysis.py
</pre></div>
</div>
<p>These are in fact the file permissions, the type of the entry in the directory
(where &#8220;tree&#8221; means a sub-directory, and &#8220;blob&#8221; means a file), the file
hashes, and the file names.</p>
<p>Here is the contents of the commit object:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git cat-file -p 96286d8b40ba9438557dd3d8af5fea6f02a4fb52
tree e1298063f6f94851ae551a292ac91ca84029c0e8
author Matthew Brett &lt;matthew.brett@gmail.com&gt; 1333293193 -0400
committer Matthew Brett &lt;matthew.brett@gmail.com&gt; 1333293193 -0400

First backup of my amazing idea
</pre></div>
</div>
</div>
<div class="section" id="git-log-what-are-the-commits-so-far">
<h3>git log - what are the commits so far?<a class="headerlink" href="#git-log-what-are-the-commits-so-far" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git log
commit 96286d8b40ba9438557dd3d8af5fea6f02a4fb52
Author: Matthew Brett &lt;matthew.brett@gmail.com&gt;
Date:   Sun Apr 1 11:13:13 2012 -0400

    First backup of my amazing idea
</pre></div>
</div>
<p>Notice that git log identies each commit with its hash.  As we saw above, the
hash for our commit was 96286d8b40ba9438557dd3d8af5fea6f02a4fb52.</p>
<p>We can also ask to the see the parents of each commit in the log:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git log --parents
commit 96286d8b40ba9438557dd3d8af5fea6f02a4fb52
Author: Matthew Brett &lt;matthew.brett@gmail.com&gt;
Date:   Sun Apr 1 11:13:13 2012 -0400

    First backup of my amazing idea
</pre></div>
</div>
<p>Why are the output of <tt class="docutils literal"><span class="pre">git</span> <span class="pre">log</span></tt> and <tt class="docutils literal"><span class="pre">git</span> <span class="pre">log</span> <span class="pre">--parents</span></tt> the same in this
case?</p>
</div>
<div class="section" id="git-branch-which-branch-are-we-on">
<h3>git branch - which branch are we on?<a class="headerlink" href="#git-branch-which-branch-are-we-on" title="Permalink to this headline">¶</a></h3>
<p>We haven&#8217;t covered branches yet. Branches are bookmarks. They associate a name
(like &#8220;master&#8221;) with a commit (such as 96286d8b40ba9438557dd3d8af5fea6f02a4fb52).</p>
<p>The default branch for git is called <tt class="docutils literal"><span class="pre">master</span></tt>. Git creates it
automatically when we do our first commit.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch
* master
</pre></div>
</div>
<p>Asking for more verbose detail shows us that the branch is pointing to a
particular commit (where the commit is given by a hash):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -v
* master 96286d8 First backup of my amazing idea
</pre></div>
</div>
<p>A branch is just a name that points to a commit.  In fact, git stores branches
as tiny text files, where the filename is the name of the branch, and the
contents is the hash of the commit that it points to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls .git/refs/heads
master
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/refs/heads/master
96286d8b40ba9438557dd3d8af5fea6f02a4fb52
</pre></div>
</div>
<p>We will soon see that, if we are working on a branch, and we do a commit, then
git will update the branch to point to the new commit.</p>
</div>
<div class="section" id="git-diff-what-has-changed">
<h3>git diff - what has changed?<a class="headerlink" href="#git-diff-what-has-changed" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s do a little bit more work... Again, in practice you&#8217;ll be editing
the files by hand, here we do it via shell commands for the sake of
automation (and therefore the reproducibility of this tutorial):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;The charts are very impressive&quot;</span> &gt;&gt; nobel_prize_paper.txt
</pre></div>
</div>
<p>And now we can ask git what is different:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git diff
diff --git a/nobel_prize_paper.txt b/nobel_prize_paper.txt
index d92d079..04d063d 100644
--- a/nobel_prize_paper.txt
+++ b/nobel_prize_paper.txt
@@ -4,3 +4,4 @@ The brain is just a <span class="nb">set </span>of random numbers
 We have discovered that the brain is a <span class="nb">set </span>of random numbers.
 
 We have charts and graphs to back us up.
+The charts are very impressive
</pre></div>
</div>
</div>
<div class="section" id="you-need-to-git-add-a-file-to-put-it-into-the-staging-area">
<h3>You need to <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></tt> a file to put it into the staging area<a class="headerlink" href="#you-need-to-git-add-a-file-to-put-it-into-the-staging-area" title="Permalink to this headline">¶</a></h3>
<p>Remember that git only commits stuff that has been added to the staging
area.</p>
<p>At the moment we have changes that have not been staged:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git status
On branch master
Changes not staged <span class="k">for </span>commit:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>

	modified:   nobel_prize_paper.txt

no changes added to commit <span class="o">(</span>use <span class="s2">&quot;git add&quot;</span> and/or <span class="s2">&quot;git commit -a&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>Git status tells us that git is keeping track of changes to
<tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>, and that the file has changed since the last
commit, and that we haven&#8217;t yet put these changes into the staging area.</p>
<p>If we try and do a commit, git will tell us there is nothing to commit,
because nothing has been put into the staging area (staged):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git commit
On branch master
Changes not staged <span class="k">for </span>commit:
	modified:   nobel_prize_paper.txt

no changes added to commit
</pre></div>
</div>
</div>
<div class="section" id="the-cycle-of-git-virtue-work-add-commit-work-add-commit">
<h3>The cycle of git virtue: work, add, commit, work, add, commit...<a class="headerlink" href="#the-cycle-of-git-virtue-work-add-commit-work-add-commit" title="Permalink to this headline">¶</a></h3>
<p>Now we have the main commands we need for working with git.  The typical cycle
is:</p>
<ul class="simple">
<li>do some changes in the working tree;</li>
<li><tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt> and <tt class="docutils literal"><span class="pre">git</span> <span class="pre">diff</span></tt> to review what has changed;</li>
<li><tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></tt> to add the changes to the staging area;</li>
<li><tt class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span></tt></li>
</ul>
<p>and repeat, and repeat.</p>
<p>For example, we have now done some work in the working tree</p>
<p>We first check what changes there are that we might want to commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git status
On branch master
Changes not staged <span class="k">for </span>commit:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>

	modified:   nobel_prize_paper.txt

no changes added to commit <span class="o">(</span>use <span class="s2">&quot;git add&quot;</span> and/or <span class="s2">&quot;git commit -a&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>We might want to check what these changes are before we stage them:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git diff
diff --git a/nobel_prize_paper.txt b/nobel_prize_paper.txt
index d92d079..04d063d 100644
--- a/nobel_prize_paper.txt
+++ b/nobel_prize_paper.txt
@@ -4,3 +4,4 @@ The brain is just a <span class="nb">set </span>of random numbers
 We have discovered that the brain is a <span class="nb">set </span>of random numbers.
 
 We have charts and graphs to back us up.
+The charts are very impressive
</pre></div>
</div>
<p>We add the changes for the one edited file to the staging area:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git add nobel_prize_paper.txt
</pre></div>
</div>
<p>We might check again that git will add the changes to the next commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git status
On branch master
Changes to be committed:
  <span class="o">(</span>use <span class="s2">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>

	modified:   nobel_prize_paper.txt
</pre></div>
</div>
<p>We do the commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git commit -m <span class="s2">&quot;Fruit of enormous thought&quot;</span>
<span class="o">[</span>master 445ad17<span class="o">]</span> Fruit of enormous thought
 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="git-updates-the-current-branch-with-the-latest-commit">
<h3>Git updates the current branch with the latest commit<a class="headerlink" href="#git-updates-the-current-branch-with-the-latest-commit" title="Permalink to this headline">¶</a></h3>
<p>Remember branches (bookmarks)?  Git has now moved the &#8220;master&#8221; branch location
up to the new commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git log
commit 445ad17988a8c97c6d04da9d5d4d550b811899a7
Author: Matthew Brett &lt;matthew.brett@gmail.com&gt;
Date:   Sun Apr 1 12:01:01 2012 -0400

    Fruit of enormous thought

commit 96286d8b40ba9438557dd3d8af5fea6f02a4fb52
Author: Matthew Brett &lt;matthew.brett@gmail.com&gt;
Date:   Sun Apr 1 11:13:13 2012 -0400

    First backup of my amazing idea
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -v
* master 445ad17 Fruit of enormous thought
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/refs/heads/master
445ad17988a8c97c6d04da9d5d4d550b811899a7
</pre></div>
</div>
<p>The first commit is the parent of the second:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git log --parents
commit 445ad17988a8c97c6d04da9d5d4d550b811899a7 96286d8b40ba9438557dd3d8af5fea6f02a4fb52
Author: Matthew Brett &lt;matthew.brett@gmail.com&gt;
Date:   Sun Apr 1 12:01:01 2012 -0400

    Fruit of enormous thought

commit 96286d8b40ba9438557dd3d8af5fea6f02a4fb52
Author: Matthew Brett &lt;matthew.brett@gmail.com&gt;
Date:   Sun Apr 1 11:13:13 2012 -0400

    First backup of my amazing idea
</pre></div>
</div>
</div>
<div class="section" id="a-nicer-log-command-using-git-config">
<h3>A nicer log command using <tt class="docutils literal"><span class="pre">git</span> <span class="pre">config</span></tt><a class="headerlink" href="#a-nicer-log-command-using-git-config" title="Permalink to this headline">¶</a></h3>
<p>It is very often useful to see a summarized version of the log.  Here is a
useful set of command flags for git log:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git log --oneline --topo-order --graph
* 445ad17 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
<p>Git supports <em>aliases:</em> new names given to command combinations. Let&#8217;s
make this handy shortlog an alias, so we only have to type <tt class="docutils literal"><span class="pre">git</span> <span class="pre">slog</span></tt>
to get this compact log.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="c"># We create our alias (this saves it in git&#39;s permanent configuration file):</span>
<span class="nv">$ </span>git config --global alias.slog <span class="s2">&quot;log --oneline --topo-order --graph&quot;</span>
<span class="nv">$ </span>
<span class="nv">$ </span><span class="c"># And now we can use it</span>
<span class="nv">$ </span>git slog
* 445ad17 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
</div>
<div class="section" id="git-mv-and-rm-moving-and-removing-files">
<h3>git mv and rm: moving and removing files<a class="headerlink" href="#git-mv-and-rm-moving-and-removing-files" title="Permalink to this headline">¶</a></h3>
<p>While <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></tt> is used to add files to the list of files that git tracks,
we must also tell it if we want their names to change or for it to stop
tracking them. In familiar Unix fashion, the <tt class="docutils literal"><span class="pre">mv</span></tt> and <tt class="docutils literal"><span class="pre">rm</span></tt> git commands do
precisely this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git mv very_clever_analysis.py slightly_dodgy_analysis.py
<span class="nv">$ </span>git status
On branch master
Changes to be committed:
  <span class="o">(</span>use <span class="s2">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>

	renamed:    very_clever_analysis.py -&gt; slightly_dodgy_analysis.py
</pre></div>
</div>
<p>Note that these changes must be committed too, to become permanent. In
git&#8217;s world, until something has been committed, it isn&#8217;t permanently
recorded anywhere.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git commit -m <span class="s2">&quot;I like this new name better&quot;</span>
<span class="o">[</span>master 73d9d4c<span class="o">]</span> I like this new name better
 1 file changed, 0 insertions<span class="o">(</span>+<span class="o">)</span>, 0 deletions<span class="o">(</span>-<span class="o">)</span>
 rename very_clever_analysis.py <span class="o">=</span>&gt; slightly_dodgy_analysis.py <span class="o">(</span>100%<span class="o">)</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git slog
* 73d9d4c I like this new name better
* 445ad17 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
<p>And <tt class="docutils literal"><span class="pre">git</span> <span class="pre">rm</span></tt> works in a similar fashion.</p>
</div>
<div class="section" id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h3>
<p>Add a new file <tt class="docutils literal"><span class="pre">file2.txt</span></tt>, commit it, make some changes to it, commit
them again, and then remove it (and don&#8217;t forget to commit this last
step).</p>
</div>
<div class="section" id="git-branch-again-making-a-new-branch">
<h3>git branch again - making a new branch<a class="headerlink" href="#git-branch-again-making-a-new-branch" title="Permalink to this headline">¶</a></h3>
<p>Remember that a branch is simply a bookmark pointing to a particular commit.</p>
<p>We can have multiple branches in a repository, where each one may point to a
different commit.</p>
<p>At the moment, we only have one branch, &#8220;master&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -v
* master 73d9d4c I like this new name better
</pre></div>
</div>
<p>We can make a new branch with the <tt class="docutils literal"><span class="pre">git</span> <span class="pre">branch</span></tt> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch experiment
<span class="nv">$ </span>git branch -v
  experiment 73d9d4c I like this new name better
* master     73d9d4c I like this new name better
</pre></div>
</div>
<p>The new branch, by default, points to the commit we are currently on, and this
commit is the also the commit that the &#8220;master&#8221; branch points to.  So, at the
moment &#8220;master&#8221; and &#8220;experiment&#8221; point to the same commit.</p>
<p>Of course this new branch is also just a tiny text file with the name of the
branch and the commit that it currently points to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls .git/refs/heads
experiment
master
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/refs/heads/experiment
73d9d4cbb877133df6e16a83ccd110b98bb12e2f
</pre></div>
</div>
</div>
<div class="section" id="git-head-points-to-the-current-branch">
<h3>git <tt class="docutils literal"><span class="pre">HEAD</span></tt> points to the current branch<a class="headerlink" href="#git-head-points-to-the-current-branch" title="Permalink to this headline">¶</a></h3>
<p>Remember that, when you make a new commit, git moves the branch pointer to
point at the new commit.  Now we have two branches, how does git know which is
the current branch, in order to move the pointer when you make a commit?</p>
<p>This information goes in a special git pointer, called <tt class="docutils literal"><span class="pre">HEAD</span></tt>.  HEAD stores
the name of the current branch. HEAD is just a tiny text file storing the
current branch:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/HEAD
ref: refs/heads/master
</pre></div>
</div>
<p>Here, HEAD is pointing to the &#8220;master&#8221; branch.  The master branch is pointing
to a particular commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -v
  experiment 73d9d4c I like this new name better
* master     73d9d4c I like this new name better
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/refs/heads/master
73d9d4cbb877133df6e16a83ccd110b98bb12e2f
</pre></div>
</div>
</div>
<div class="section" id="developing-on-different-branches">
<h3>Developing on different branches<a class="headerlink" href="#developing-on-different-branches" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s now illustrate all of this with a concrete example. We get our bearings
first:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git status
On branch master
nothing to commit, working directory clean
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls
nobel_prize_paper.txt
slightly_dodgy_analysis.py
stunning_figure.png
</pre></div>
</div>
<p>We are now going to try two different routes of development: we will add one
file on on the <tt class="docutils literal"><span class="pre">experiment</span></tt> branch, and we will add another file on the
<tt class="docutils literal"><span class="pre">master</span></tt> branch. We will then merge the <tt class="docutils literal"><span class="pre">experiment</span></tt> branch into
<tt class="docutils literal"><span class="pre">master</span></tt>.</p>
<p>How do we start working on this branch <tt class="docutils literal"><span class="pre">experiment</span></tt> rather than
<tt class="docutils literal"><span class="pre">master</span></tt>?</p>
</div>
<div class="section" id="git-checkout-set-the-current-branch-set-the-working-tree-from-a-commit">
<h3>git checkout - set the current branch, set the working tree from a commit<a class="headerlink" href="#git-checkout-set-the-current-branch-set-the-working-tree-from-a-commit" title="Permalink to this headline">¶</a></h3>
<p>Up until now we have been on the <tt class="docutils literal"><span class="pre">master</span></tt> branch. When we make a
commit, the <tt class="docutils literal"><span class="pre">master</span></tt> branch pointer (<tt class="docutils literal"><span class="pre">.git/refs/heads/master</span></tt>) moves
up to point to our most recent commit.</p>
<p><tt class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span></tt> can switch us to using another branch:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git checkout experiment
Switched to branch <span class="s1">&#39;experiment&#39;</span>
</pre></div>
</div>
<p>What just happened?</p>
<p>The current branch has changed (notice the asterisk in front of
<tt class="docutils literal"><span class="pre">experiment</span></tt>).</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -v
* experiment 73d9d4c I like this new name better
  master     73d9d4c I like this new name better
</pre></div>
</div>
<p>Git <tt class="docutils literal"><span class="pre">HEAD</span></tt> now points to the <tt class="docutils literal"><span class="pre">experiment</span></tt> branch:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/HEAD
ref: refs/heads/experiment
</pre></div>
</div>
<p>As we&#8217;ll see later, <tt class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">somebranch</span></tt> also sets the contents
of the working tree to match the commit contents for <tt class="docutils literal"><span class="pre">somebranch</span></tt>. In
this case the commits for <tt class="docutils literal"><span class="pre">master</span></tt> and <tt class="docutils literal"><span class="pre">experiment</span></tt> are currently
the same, meaning they have the same corresponding working tree, so our
working tree did not change.</p>
<p>Now let&#8217;s do some changes on the <tt class="docutils literal"><span class="pre">experiment</span></tt> branch:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;Some crazy idea&quot;</span> &gt; an_experiment.txt
<span class="nv">$ </span>git add an_experiment.txt
<span class="nv">$ </span>git commit -m <span class="s2">&quot;Trying something new&quot;</span>
<span class="nv">$ </span>git slog
<span class="o">[</span>experiment 1523be4<span class="o">]</span> Trying something new
 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 an_experiment.txt
* 1523be4 Trying something new
* 73d9d4c I like this new name better
* 445ad17 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
<p>Notice we have a new file called <tt class="docutils literal"><span class="pre">an_experiment.txt</span></tt> in this branch:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls
an_experiment.txt
nobel_prize_paper.txt
slightly_dodgy_analysis.py
stunning_figure.png
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">experiment</span></tt> branch pointer has now moved up to the current commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/refs/heads/experiment
1523be46eb4be82d6c4e23890bd0a3cafe391bd6
</pre></div>
</div>
<p>But the <tt class="docutils literal"><span class="pre">master</span></tt> branch points to the same place as it did before:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -v
* experiment 1523be4 Trying something new
  master     73d9d4c I like this new name better
</pre></div>
</div>
</div>
<div class="section" id="git-checkout-again-reseting-the-working-tree">
<h3>git checkout again - reseting the working tree<a class="headerlink" href="#git-checkout-again-reseting-the-working-tree" title="Permalink to this headline">¶</a></h3>
<p>If <tt class="docutils literal"><span class="pre">somewhere</span></tt> is a branch name, then <tt class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">somewhere</span></tt>
selects <tt class="docutils literal"><span class="pre">somewhere</span></tt> as the current branch. It also resets the working
tree to match the working tree for that commit.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git checkout master
<span class="nv">$ </span>cat .git/HEAD
ref: refs/heads/master
</pre></div>
</div>
<p>We&#8217;re back to the working tree as of the <tt class="docutils literal"><span class="pre">master</span></tt> branch;
<tt class="docutils literal"><span class="pre">an_experiment.txt</span></tt> has gone now.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls
nobel_prize_paper.txt
slightly_dodgy_analysis.py
stunning_figure.png
</pre></div>
</div>
<p>Meanwhile we do some more work on master:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git slog
* 73d9d4c I like this new name better
* 445ad17 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;All the while, more work goes on in master...&quot;</span> &gt;&gt; boring_idea.txt
<span class="nv">$ </span>git add boring_idea.txt
<span class="nv">$ </span>git commit -m <span class="s2">&quot;The mainline keeps moving&quot;</span>
<span class="nv">$ </span>git slog
<span class="o">[</span>master 6e145e0<span class="o">]</span> The mainline keeps moving
 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 boring_idea.txt
* 6e145e0 The mainline keeps moving
* 73d9d4c I like this new name better
* 445ad17 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
</div>
<div class="section" id="git-merge-merging-changes-from-different-branches">
<h3>git merge - merging changes from different branches<a class="headerlink" href="#git-merge-merging-changes-from-different-branches" title="Permalink to this headline">¶</a></h3>
<p>We do a merge when we have made some changes in one branch, and we want to
bring (merge) these changes into another branch.</p>
<p>The typical situation is where we have made some useful changes in an
experimental branch - like our <tt class="docutils literal"><span class="pre">experiment</span></tt> branch, and we decide we want to
make these changes part of the main line of development - often the <tt class="docutils literal"><span class="pre">master</span></tt>
branch.</p>
<p>Here is the merge:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git merge experiment -m <span class="s2">&quot;Merge in the experiment&quot;</span>
Merge made by the <span class="s1">&#39;recursive&#39;</span> strategy.
 an_experiment.txt | 1 +
 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 an_experiment.txt
</pre></div>
</div>
<p>Notice now that the master branch has the new file <tt class="docutils literal"><span class="pre">an_experiment.txt</span></tt> from
the <tt class="docutils literal"><span class="pre">experiment</span></tt> branch, as well as the new file <tt class="docutils literal"><span class="pre">boring_idea.txt</span></tt> from
the master branch:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls
an_experiment.txt
boring_idea.txt
nobel_prize_paper.txt
slightly_dodgy_analysis.py
stunning_figure.png
</pre></div>
</div>
<p>The git log output shows us two lines of development diverging and then
merging:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git slog
*   6d7e9e5 Merge in the experiment
|<span class="se">\ </span> 
| * 1523be4 Trying something new
* | 6e145e0 The mainline keeps moving
|/  
* 73d9d4c I like this new name better
* 445ad17 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
<p>The merge commit has two &#8220;parent&#8221; commits, which are the previous commit on
<tt class="docutils literal"><span class="pre">master</span></tt> and the previous commit on <tt class="docutils literal"><span class="pre">experiment</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git slog --parents
*   6d7e9e5 6e145e0 1523be4 Merge in the experiment
|<span class="se">\ </span> 
| * 1523be4 73d9d4c Trying something new
* | 6e145e0 73d9d4c The mainline keeps moving
|/  
* 73d9d4c 445ad17 I like this new name better
* 445ad17 96286d8 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
</div>
<div class="section" id="an-important-aside-conflict-management">
<h3>An important aside: conflict management<a class="headerlink" href="#an-important-aside-conflict-management" title="Permalink to this headline">¶</a></h3>
<p>While git is very good at merging, if two different branches modify the
same file in the same location, it simply can&#8217;t decide which change
should prevail. At that point, human intervention is necessary to make
the decision. Git will help you by marking the location in the file that
has a problem, but it&#8217;s up to you to resolve the conflict. Let&#8217;s see how
that works by intentionally creating a conflict.</p>
<p>We start by making another new branch and making a change to our experiment
file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch trouble
<span class="nv">$ </span>git checkout trouble
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;This is going to be a problem...&quot;</span> &gt;&gt; an_experiment.txt
<span class="nv">$ </span>git add an_experiment.txt
<span class="nv">$ </span>git commit -m <span class="s2">&quot;Changes in the trouble branch&quot;</span>
<span class="o">[</span>trouble d561bc5<span class="o">]</span> Changes in the trouble branch
 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
</pre></div>
</div>
<p>And now we go back to the master branch, where we change the <em>same</em>
file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git checkout master
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;More work on the master branch...&quot;</span> &gt;&gt; an_experiment.txt
<span class="nv">$ </span>git add an_experiment.txt
<span class="nv">$ </span>git commit -m <span class="s2">&quot;Mainline work&quot;</span>
<span class="o">[</span>master 7a1e5ad<span class="o">]</span> Mainline work
 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
</pre></div>
</div>
<p>So now let&#8217;s see what happens if we try to merge the <tt class="docutils literal"><span class="pre">trouble</span></tt> branch
into <tt class="docutils literal"><span class="pre">master</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git merge trouble -m <span class="s2">&quot;Unlikely this one will work&quot;</span>
Auto-merging an_experiment.txt
CONFLICT <span class="o">(</span>content<span class="o">)</span>: Merge conflict in an_experiment.txt
Automatic merge failed; fix conflicts and <span class="k">then </span>commit the result.
</pre></div>
</div>
<p>Let&#8217;s see what git has put into our file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat an_experiment.txt
Some crazy idea
<span class="o">&lt;&lt;&lt;&lt;&lt;&lt;</span>&lt; HEAD
More work on the master branch...
<span class="o">=======</span>
This is going to be a problem...
&gt;&gt;&gt;&gt;&gt;&gt;&gt; trouble
</pre></div>
</div>
<p>Read this as:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">HEAD</span></tt> - the current branch - (between <tt class="docutils literal"><span class="pre">&lt;&lt;</span></tt>... and <tt class="docutils literal"><span class="pre">==</span></tt>) adds
<tt class="docutils literal"><span class="pre">More</span> <span class="pre">work</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">master</span> <span class="pre">branch...</span></tt>;</li>
<li>the <tt class="docutils literal"><span class="pre">trouble</span></tt> branch (between <tt class="docutils literal"><span class="pre">==</span></tt>... and <tt class="docutils literal"><span class="pre">&gt;&gt;</span></tt>...) adds
<tt class="docutils literal"><span class="pre">This</span> <span class="pre">is</span> <span class="pre">going</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">a</span> <span class="pre">problem...</span></tt>.</li>
</ul>
<p>At this point, we go into the file with a text editor, decide which
changes to keep, and make a new commit that records our decision.</p>
<p>I&#8217;ll do the edits by writing the file I want directly in this case:</p>
<div class="highlight-python"><div class="highlight"><pre># file: an_experiment.txt
Some crazy idea
More work on the master branch...
This is going to be a problem...
</pre></div>
</div>
<p>I&#8217;ve now made the edits. I decided that both pieces of text were useful,
but integrated them with some changes:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git status
On branch master
You have unmerged paths.
  <span class="o">(</span>fix conflicts and run <span class="s2">&quot;git commit&quot;</span><span class="o">)</span>

Unmerged paths:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to mark resolution<span class="o">)</span>

	both modified:      an_experiment.txt

no changes added to commit <span class="o">(</span>use <span class="s2">&quot;git add&quot;</span> and/or <span class="s2">&quot;git commit -a&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>Let&#8217;s then make our new commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git add an_experiment.txt
<span class="nv">$ </span>git commit -m <span class="s2">&quot;Completed merge of trouble, fixing conflicts along the way&quot;</span>
<span class="o">[</span>master 8878a49<span class="o">]</span> Completed merge of trouble, fixing conflicts along the way
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git slog
*   8878a49 Completed merge of trouble, fixing conflicts along the way
|<span class="se">\ </span> 
| * d561bc5 Changes in the trouble branch
* | 7a1e5ad Mainline work
|/  
*   6d7e9e5 Merge in the experiment
|<span class="se">\ </span> 
| * 1523be4 Trying something new
* | 6e145e0 The mainline keeps moving
|/  
* 73d9d4c I like this new name better
* 445ad17 Fruit of enormous thought
* 96286d8 First backup of my amazing idea
</pre></div>
</div>
</div>
</div>
<div class="section" id="git-remotes-working-with-other-people-making-backups">
<h2>git remotes - working with other people, making backups<a class="headerlink" href="#git-remotes-working-with-other-people-making-backups" title="Permalink to this headline">¶</a></h2>
<p>Now you are keeping the history of your data, you also want to make sure you
have a backup in case your laptop dies.</p>
<p>You might want to work with a friend on the same project.  Perhaps your friend
Anne is also working on the paper, and you want to merge her changes into
yours.</p>
<p>We use git &#8220;remotes&#8221; to solve both of these problems.</p>
<div class="section" id="keeping-backups">
<h3>Keeping backups<a class="headerlink" href="#keeping-backups" title="Permalink to this headline">¶</a></h3>
<p>First - a simple backup. Let&#8217;s say you have an external backup disk and you
want to record all the history of your work on the backup disk.</p>
<p>To do this you need three steps:</p>
<ul class="simple">
<li>Make an empty backup repository on the external backup disk</li>
<li>Point your current git repository at the backup repository with <tt class="docutils literal"><span class="pre">git</span> <span class="pre">remote</span>
<span class="pre">add</span></tt></li>
<li>Send the changes to the backup repository with <tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span></tt></li>
</ul>
<div class="section" id="make-the-empty-backup-repository">
<h4>Make the empty backup repository<a class="headerlink" href="#make-the-empty-backup-repository" title="Permalink to this headline">¶</a></h4>
<p>Let&#8217;s say your external disk is mounted at <tt class="docutils literal"><span class="pre">/Volumes/usb_disk</span></tt>.</p>
<p>We make a new empty repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git init --bare /Volumes/my_usb_disk/nobel_prize_backup.git
Initialized empty Git repository in /Users/mb312/dev_trees/pydagogue/my_usb_disk/nobel_prize_backup.git/
</pre></div>
</div>
<p>Notice the <tt class="docutils literal"><span class="pre">--bare</span></tt> flag.  This tells git to make a repository that does not
have a working tree, but only the <tt class="docutils literal"><span class="pre">.git</span></tt> repository directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls /Volumes/my_usb_disk/nobel_prize_backup.git
HEAD
branches
config
description
hooks
info
objects
refs
</pre></div>
</div>
<p>This is what we want in this case, because we will not ever want to edit the
files in the <tt class="docutils literal"><span class="pre">/Volumes/my_usb_disk/nobel_prize_backup.git</span></tt> backup
repository, we will only be editing files in our local <tt class="docutils literal"><span class="pre">nobel_prize</span></tt>
directory, committing those changes locally (as we have done above), and then
&#8220;pushing&#8221; these changes to the backup repository.</p>
</div>
<div class="section" id="tell-the-current-git-repository-about-the-backup-repository">
<h4>Tell the current git repository about the backup repository<a class="headerlink" href="#tell-the-current-git-repository-about-the-backup-repository" title="Permalink to this headline">¶</a></h4>
<p>Check we&#8217;re in our local git repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">pwd</span>
/Users/mb312/dev_trees/pydagogue/nobel_prize
</pre></div>
</div>
<p>Add a remote.  A remote is a link to another repository.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git remote add usb_backup /Volumes/my_usb_disk/nobel_prize_backup.git
</pre></div>
</div>
<p>List the remotes:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git remote -v
usb_backup	/Volumes/my_usb_disk/nobel_prize_backup.git <span class="o">(</span>fetch<span class="o">)</span>
usb_backup	/Volumes/my_usb_disk/nobel_prize_backup.git <span class="o">(</span>push<span class="o">)</span>
</pre></div>
</div>
<p>The list shows that we can both <tt class="docutils literal"><span class="pre">fetch</span></tt> and <tt class="docutils literal"><span class="pre">push</span></tt> to this repository, of
which more later.</p>
<p>The entire of the rest of the information about the remote is in the
repository file config file – <tt class="docutils literal"><span class="pre">.git/config</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/config
<span class="o">[</span>core<span class="o">]</span>
	<span class="nv">repositoryformatversion</span> <span class="o">=</span> 0
	<span class="nv">filemode</span> <span class="o">=</span> <span class="nb">true</span>
<span class="nb">	</span><span class="nv">bare</span> <span class="o">=</span> <span class="nb">false</span>
<span class="nb">	</span><span class="nv">logallrefupdates</span> <span class="o">=</span> <span class="nb">true</span>
<span class="nb">	</span><span class="nv">ignorecase</span> <span class="o">=</span> <span class="nb">true</span>
<span class="nb">	</span><span class="nv">precomposeunicode</span> <span class="o">=</span> <span class="nb">true</span>
<span class="o">[</span>remote <span class="s2">&quot;usb_backup&quot;</span><span class="o">]</span>
	<span class="nv">url</span> <span class="o">=</span> /Volumes/my_usb_disk/nobel_prize_backup.git
	<span class="nv">fetch</span> <span class="o">=</span> +refs/heads/*:refs/remotes/usb_backup/*
</pre></div>
</div>
</div>
<div class="section" id="git-push-push-all-data-for-local-branches-to-the-remote">
<h4>git push – push all data for local branches to the remote<a class="headerlink" href="#git-push-push-all-data-for-local-branches-to-the-remote" title="Permalink to this headline">¶</a></h4>
<p>We now want to synchronize the data in our <tt class="docutils literal"><span class="pre">nobel_prize</span></tt> repository with the
remote <tt class="docutils literal"><span class="pre">my_usb_backup</span></tt>.  The command to do this is <tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span></tt>.</p>
<p>Before we do the push, there are no objects in the <tt class="docutils literal"><span class="pre">.git/objects</span></tt> directory
of the <tt class="docutils literal"><span class="pre">my_usb_backup</span></tt> backup repo:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree -a /Volumes/my_usb_disk/nobel_prize_backup.git/objects
/Volumes/my_usb_disk/nobel_prize_backup.git/objects
├── info
└── pack

2 directories, 0 files
</pre></div>
</div>
<p>Then we push:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git push usb_backup master
To /Volumes/my_usb_disk/nobel_prize_backup.git
 * <span class="o">[</span>new branch<span class="o">]</span>      master -&gt; master
</pre></div>
</div>
<p>This command tells git to take all the information necessary to reconstruct
the history of the <tt class="docutils literal"><span class="pre">master</span></tt> branch, and send it to the remote repository.
Sure enough, we now have files in <tt class="docutils literal"><span class="pre">.git/objects</span></tt> of the backup repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tree -a /Volumes/my_usb_disk/nobel_prize_backup.git/objects
/Volumes/my_usb_disk/nobel_prize_backup.git/objects
├── 04
│   └── d063db4b257f62dab66a91bbbbe128ec71c720
├── 0d
│   └── 6c257b396bf7778e630deec2fdbb443d38723c
├── 15
│   └── 23be46eb4be82d6c4e23890bd0a3cafe391bd6
├── 19
│   └── a4289becf85485352b9a2238bb5348d1e6c5bc
├── 1f
│   └── 560acd0167ca09dafdaeb2e6439689ad7aca19
├── 31
│   └── 0955ff38a3424702fd3cbf5c7ca0311f306b1c
├── 3f
│   └── 8b4f91e337c3a5113e31b89abc0d086196a489
├── 44
│   └── 5ad17988a8c97c6d04da9d5d4d550b811899a7
├── 52
│   └── 07252ea9bc2368a1907771014c0829ac43b30b
├── 68
│   └── 9766b8034a9325939356e9fb56f1a533ee448c
├── 6c
│   └── 337bd7799f1729a6e557099ea1d73ab7dad312
├── 6d
│   └── 7e9e53701864e0f5a9ce649104849bd23c9ae5
├── 6e
│   └── 145e0356b286c998275129f3d72961b8165a68
├── 73
│   └── d9d4cbb877133df6e16a83ccd110b98bb12e2f
├── 7a
│   └── 1e5ad4d5ba79b093c604369aeeb9340eb41679
├── 7c
│   └── aea43055fe2f40df9f370745cb58809b39b26f
├── 88
│   └── 78a497de279fc9d2b9da42728b2f5fa4dce001
├── 8a
│   └── dc8bf371d669242ea998f78f9916867cc6203c
├── 94
│   └── 3c3790b3e924ab6499ce4cc191e00a98094146
├── 96
│   └── 286d8b40ba9438557dd3d8af5fea6f02a4fb52
├── 9f
│   └── fc311b29f0c87bf502b92df951d90ef88c1c7d
├── ad
│   └── 38fb606954c94432403432e804544a9a75334f
├── c4
│   └── a443cb712bb32a981b8bfd25ba1d15dde843c1
├── d2
│   └── b93bd091bfbde188b4898a13fd12bb05b9183e
├── d5
│   └── 61bc5707c20a4c89ac22d4c5606f59fdd15d8a
├── d9
│   └── 2d079af6a7f276cc8d63dcf2549c03e7deb553
├── e1
│   └── 298063f6f94851ae551a292ac91ca84029c0e8
├── info
└── pack

29 directories, 27 files
</pre></div>
</div>
<p>You&#8217;ll see that the &#8216;master&#8217; branch in the backup repo now points to the same
commit as the master branch in the local repo:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/refs/heads/master
8878a497de279fc9d2b9da42728b2f5fa4dce001
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat /Volumes/my_usb_disk/nobel_prize_backup.git/refs/heads/master
8878a497de279fc9d2b9da42728b2f5fa4dce001
</pre></div>
</div>
<p>The local repo has a copy of the last known position of the master branch in
the remote repo.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat .git/refs/remotes/usb_backup/master
8878a497de279fc9d2b9da42728b2f5fa4dce001
</pre></div>
</div>
<p>You can see the last known positions of the remote branches using the <tt class="docutils literal"><span class="pre">-r</span></tt>
flag to <tt class="docutils literal"><span class="pre">git</span> <span class="pre">branch</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -r  -v
  usb_backup/master 8878a49 Completed merge of trouble, fixing conflicts along the way
</pre></div>
</div>
<p>To see both local and remote branches, use the <tt class="docutils literal"><span class="pre">-a</span></tt> flag:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -a  -v
  experiment                1523be4 Trying something new
* master                    8878a49 Completed merge of trouble, fixing conflicts along the way
  trouble                   d561bc5 Changes in the trouble branch
  remotes/usb_backup/master 8878a49 Completed merge of trouble, fixing conflicts along the way
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span></tt> is an excellent way to do backups, because it only transfers the
information that the remote repository does not have.</p>
<p>Let&#8217;s see that in action.</p>
<p>First we make a new commit in the local repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;Express confidence in the study&quot;</span> &gt;&gt; nobel_prize_paper.txt
<span class="nv">$ </span>git add nobel_prize_paper.txt
<span class="nv">$ </span>git commit -m <span class="s2">&quot;Buff up the paper some more&quot;</span>
<span class="o">[</span>master c5b9b35<span class="o">]</span> Buff up the paper some more
 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
</pre></div>
</div>
<p>Git updated the local <tt class="docutils literal"><span class="pre">master</span></tt> branch, but the remote does not know about
this update yet:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -a -v
  experiment                1523be4 Trying something new
* master                    c5b9b35 Buff up the paper some more
  trouble                   d561bc5 Changes in the trouble branch
  remotes/usb_backup/master 8878a49 Completed merge of trouble, fixing conflicts along the way
</pre></div>
</div>
<p>We already know there will be three new objects in <tt class="docutils literal"><span class="pre">.git/objects</span></tt> after this
commit.  There will be: one for the modified <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>; one
for the modified directory listing with the new hash for
<tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>; and one for the commit object.  The commit object
we can see from the top of <tt class="docutils literal"><span class="pre">git</span> <span class="pre">log</span></tt>. The <tt class="docutils literal"><span class="pre">-1</span></tt> flag to <tt class="docutils literal"><span class="pre">git</span> <span class="pre">log</span></tt> tells
git to show just the first commit from the log:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git log -1
commit c5b9b353be6e16b02f534ecc17ea0ffd2ec86502
Author: Matthew Brett &lt;matthew.brett@gmail.com&gt;
Date:   Sun Apr 1 15:13:13 2012 -0400

    Buff up the paper some more
</pre></div>
</div>
<p>So the commit is c5b9b353be6e16b02f534ecc17ea0ffd2ec86502.  We can get the directory listing object
from the commit object:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git cat-file -p c5b9b353be6e16b02f534ecc17ea0ffd2ec86502
tree 5915a38187f560bf99eff97740c4ff5b611b6175
parent 8878a497de279fc9d2b9da42728b2f5fa4dce001
author Matthew Brett &lt;matthew.brett@gmail.com&gt; 1333307593 -0400
committer Matthew Brett &lt;matthew.brett@gmail.com&gt; 1333307593 -0400

Buff up the paper some more
</pre></div>
</div>
<p>We can show the directory listing contents to get the object for the new
version of <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git cat-file -p 5915a38187f560bf99eff97740c4ff5b611b6175
100644 blob 3f8b4f91e337c3a5113e31b89abc0d086196a489	an_experiment.txt
100644 blob 0d6c257b396bf7778e630deec2fdbb443d38723c	boring_idea.txt
100644 blob 8b06b77a69682f5c9d3daf372bfe39159e1a8d23	nobel_prize_paper.txt
100644 blob 8adc8bf371d669242ea998f78f9916867cc6203c	slightly_dodgy_analysis.py
100644 blob 9ffc311b29f0c87bf502b92df951d90ef88c1c7d	stunning_figure.png
</pre></div>
</div>
<p>We do have these objects in the local repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ls .git/objects/c5/b9b353be6e16b02f534ecc17ea0ffd2ec86502
<span class="nv">$ </span>ls .git/objects/59/15a38187f560bf99eff97740c4ff5b611b6175
<span class="nv">$ </span>ls .git/objects/8b/06b77a69682f5c9d3daf372bfe39159e1a8d23
.git/objects/c5/b9b353be6e16b02f534ecc17ea0ffd2ec86502
.git/objects/59/15a38187f560bf99eff97740c4ff5b611b6175
.git/objects/8b/06b77a69682f5c9d3daf372bfe39159e1a8d23
</pre></div>
</div>
<p>– but we don&#8217;t have these objects in the remote repository yet (we haven&#8217;t
done a <tt class="docutils literal"><span class="pre">push</span></tt>):</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ REMOTE_OBJECTS</span><span class="o">=</span>/Volumes/my_usb_disk/nobel_prize_backup.git/objects
<span class="nv">$ </span>ls <span class="nv">$REMOTE_OBJECTS</span>/c5/b9b353be6e16b02f534ecc17ea0ffd2ec86502
<span class="nv">$ </span>ls <span class="nv">$REMOTE_OBJECTS</span>/59/15a38187f560bf99eff97740c4ff5b611b6175
<span class="nv">$ </span>ls <span class="nv">$REMOTE_OBJECTS</span>/8b/06b77a69682f5c9d3daf372bfe39159e1a8d23
ls: /Volumes/my_usb_disk/nobel_prize_backup.git/objects/c5/b9b353be6e16b02f534ecc17ea0ffd2ec86502: No such file or directory
ls: /Volumes/my_usb_disk/nobel_prize_backup.git/objects/59/15a38187f560bf99eff97740c4ff5b611b6175: No such file or directory
ls: /Volumes/my_usb_disk/nobel_prize_backup.git/objects/8b/06b77a69682f5c9d3daf372bfe39159e1a8d23: No such file or directory
</pre></div>
</div>
<p>Now we do a push:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git push usb_backup master
To /Volumes/my_usb_disk/nobel_prize_backup.git
   8878a49..c5b9b35  master -&gt; master
</pre></div>
</div>
<p>The branches are synchronized again:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>git branch -a -v
  experiment                1523be4 Trying something new
* master                    c5b9b35 Buff up the paper some more
  trouble                   d561bc5 Changes in the trouble branch
  remotes/usb_backup/master c5b9b35 Buff up the paper some more
</pre></div>
</div>
<p>We do have the new objects in the remote repository:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ REMOTE_OBJECTS</span><span class="o">=</span>/Volumes/my_usb_disk/nobel_prize_backup.git/objects
<span class="nv">$ </span>ls <span class="nv">$REMOTE_OBJECTS</span>/c5/b9b353be6e16b02f534ecc17ea0ffd2ec86502
<span class="nv">$ </span>ls <span class="nv">$REMOTE_OBJECTS</span>/59/15a38187f560bf99eff97740c4ff5b611b6175
<span class="nv">$ </span>ls <span class="nv">$REMOTE_OBJECTS</span>/8b/06b77a69682f5c9d3daf372bfe39159e1a8d23
/Volumes/my_usb_disk/nobel_prize_backup.git/objects/c5/b9b353be6e16b02f534ecc17ea0ffd2ec86502
/Volumes/my_usb_disk/nobel_prize_backup.git/objects/59/15a38187f560bf99eff97740c4ff5b611b6175
/Volumes/my_usb_disk/nobel_prize_backup.git/objects/8b/06b77a69682f5c9d3daf372bfe39159e1a8d23
</pre></div>
</div>
</div>
<div class="section" id="an-algorithm-for-git-push">
<h4>An algorithm for git push<a class="headerlink" href="#an-algorithm-for-git-push" title="Permalink to this headline">¶</a></h4>
<p>Now we know about how git stores its objects, we can work out an algorithm for
doing a push.</p>
<ol class="arabic">
<li><p class="first">First send the branch file containing the commit hash to the remote
repository (in our case <tt class="docutils literal"><span class="pre">.git/refs/heads/master</span></tt>).</p>
</li>
<li><p class="first">Get the commit hash (in our case c5b9b353be6e16b02f534ecc17ea0ffd2ec86502)</p>
</li>
<li><p class="first">Does the remote have this object in
<tt class="docutils literal"><span class="pre">.git/objects/c5/b9b353be6e16b02f534ecc17ea0ffd2ec86502</span></tt>? In that case
the remote is already up to date, and we can stop.</p>
</li>
<li><p class="first">If not, follow the parents of this commit back, along the path formed by
the parents of each commit, until we find a commit that the remote
repository does have.  Now we have a list of commits that that the remote
repository does not have.  Call these the &#8220;missing commits&#8221;.*</p>
</li>
<li><p class="first">Send all the missing commits to the remote repo.</p>
</li>
<li><p class="first">For every missing commit:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>Get the hash of the tree object from the commit</li>
<li>If the remote repo does not have this tree object, send it</li>
<li>Read the tree object directory listing</li>
<li>For any file hash, check if the remote has it this object and send it
if not</li>
<li>For every tree in the directory listing (subdirectory tree), follow the
same procedure [from a.)].</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Update the remote branch (remote <tt class="docutils literal"><span class="pre">refs/heads/master</span></tt> in our case) to
point to the same commit as the local branch.  In our case that would
update remote <tt class="docutils literal"><span class="pre">refs/heads/master</span></tt> to point to commit hash
<a href="#id3"><span class="problematic" id="id4">|merged-master-3|</span></a>.</p>
</li>
<li><p class="first">Update the local record of the remote branch to point to the same commit.
In our case, update local <tt class="docutils literal"><span class="pre">refs/remotes/usb_backup/master</span></tt> to point to
<a href="#id5"><span class="problematic" id="id6">|merged-master-3|</span></a>.</p>
</li>
</ol>
<p>Here is what will happen in our case. We first read the commit hash from
<tt class="docutils literal"><span class="pre">refs/heads/master</span></tt> to get the commit object, which is c5b9b353be6e16b02f534ecc17ea0ffd2ec86502.
We check whether the remote repo has this commit object.  It doesn&#8217;t, so we
send it (copy it) to the remote <tt class="docutils literal"><span class="pre">objects</span></tt> directory.</p>
<p>We read the object c5b9b353be6e16b02f534ecc17ea0ffd2ec86502 to find the parent commit, which is
8878a497de279fc9d2b9da42728b2f5fa4dce001.  We check if the remote has this, and it does, so we only
have one missing commit to copy.</p>
<p>We read the missing commit object c5b9b353be6e16b02f534ecc17ea0ffd2ec86502 to find the tree object,
which is <tt class="docutils literal"><span class="pre">5915a38187f560bf99eff97740c4ff5b611b6175</span></tt>.  The remote repo does
not have it, so we send it (copy it).  We check the entries in the tree object
<tt class="docutils literal"><span class="pre">5915a38187f560bf99eff97740c4ff5b611b6175</span></tt>. There are five objects in this
tree, all files (blobs).  Of these, the remote has all but the latest version
of <tt class="docutils literal"><span class="pre">nobel_prize_paper.txt</span></tt>, with hash
<tt class="docutils literal"><span class="pre">8b06b77a69682f5c9d3daf372bfe39159e1a8d23</span></tt>.  We send that.  Finally we
update the remote <tt class="docutils literal"><span class="pre">refs/heads/master</span></tt> to point to c5b9b353be6e16b02f534ecc17ea0ffd2ec86502 and we
update the local <tt class="docutils literal"><span class="pre">refs/remotes/usb_backup/master</span></tt> to point to
c5b9b353be6e16b02f534ecc17ea0ffd2ec86502.  Done.</p>
</div>
</div>
<div class="section" id="other-useful-commands">
<h3>Other useful commands<a class="headerlink" href="#other-useful-commands" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.kernel.org/pub/software/scm/git/docs/git-show.html">show</a></li>
<li><a class="reference external" href="http://www.kernel.org/pub/software/scm/git/docs/git-reflog.html">reflog</a></li>
<li><a class="reference external" href="http://www.kernel.org/pub/software/scm/git/docs/git-rebase.html">rebase</a></li>
<li><a class="reference external" href="http://www.kernel.org/pub/software/scm/git/docs/git-tag.html">tag</a></li>
</ul>
</div>
<div class="section" id="git-resources">
<h3>Git resources<a class="headerlink" href="#git-resources" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="introductory-materials">
<h3>Introductory materials<a class="headerlink" href="#introductory-materials" title="Permalink to this headline">¶</a></h3>
<p>There are lots of good tutorials and introductions for Git, which you
can easily find yourself; this is just a short list of things I&#8217;ve found
useful. For a beginner, I would recommend the following &#8216;core&#8217; reading
list, and below I mention a few extra resources:</p>
<ol class="arabic simple">
<li>The smallest, and in the style of this tutorial: <a class="reference external" href="http://rogerdudler.github.com/git-guide">git - the simple
guide</a> contains &#8216;just the
basics&#8217;. Very quick read.</li>
<li>The concise <a class="reference external" href="http://gitref.org">Git Reference</a>: compact but with
all the key ideas. If you only read one document, make it this one.</li>
<li>In my own experience, the most useful resource was <a class="reference external" href="http://www.sbf5.com/~cduan/technical/git">Understanding Git
Conceptually</a>. Git has a
reputation for being hard to use, but I have found that with a clear
view of what is actually a <em>very simple</em> internal design, its
behavior is remarkably consistent, simple and comprehensible.</li>
<li>For more detail, see the start of the excellent <a class="reference external" href="http://progit.org/book">Pro
Git</a> online book, or similarly the early
parts of the <a class="reference external" href="http://book.git-scm.com">Git community book</a>. Pro
Git&#8217;s chapters are very short and well illustrated; the community
book tends to have more detail and has nice screencasts at the end of
some sections.</li>
</ol>
<p>If you are really impatient and just want a quick start, this <a class="reference external" href="http://www.ralfebert.de/blog/tools/visual_git_tutorial_1">visual
git
tutorial</a>
may be sufficient. It is nicely illustrated with diagrams that show what
happens on the filesystem.</p>
<p>For windows users, <a class="reference external" href="http://nathanj.github.com/gitguide/tour.html">an Illustrated Guide to Git on
Windows</a> is useful in
that it contains also some information about handling SSH (necessary to
interface with git hosted on remote servers when collaborating) as well
as screenshots of the Windows interface.</p>
<dl class="docutils">
<dt>Cheat sheets</dt>
<dd>Two different
<a class="reference external" href="http://zrusin.blogspot.com/2007/09/git-cheat-sheet.html">cheat</a>
<a class="reference external" href="http://jan-krueger.net/development/git-cheat-sheet-extended-edition">sheets</a>
in PDF format that can be printed for frequent reference.</dd>
</dl>
</div>
<div class="section" id="beyond-the-basics">
<h3>Beyond the basics<a class="headerlink" href="#beyond-the-basics" title="Permalink to this headline">¶</a></h3>
<p>As you&#8217;ve seen, this tutorial makes the bold assumption that you&#8217;ll be
able to understand how git works by seeing how it is <em>built</em>. These two
documents, written in a similar spirit, are probably the most useful
descriptions of the Git architecture short of diving into the actual
implementation. They walk you through how you would go about building a
version control system with a little story. By the end you realize that
Git&#8217;s model is almost an inevitable outcome of the proposed constraints:</p>
<ul class="simple">
<li>The <a class="reference external" href="http://tom.preston-werner.com/2009/05/19/the-git-parable.html">Git
parable</a>
by Tom Preston-Werner.</li>
<li><a class="reference external" href="http://matthew-brett.github.com/pydagogue/foundation.html">Git
foundations</a>
by Matthew Brett.</li>
</ul>
<dl class="docutils">
<dt><a class="reference external" href="http://www.gitready.com">Git ready</a></dt>
<dd>A great website of posts on specific git-related topics, organized
by difficulty.</dd>
<dt><a class="reference external" href="http://sourceforge.net/projects/qgit/">QGit</a>: an excellent Git GUI</dt>
<dd>Git ships by default with gitk and git-gui, a pair of Tk graphical
clients to browse a repo and to operate in it. I personally have
found <a class="reference external" href="http://sourceforge.net/projects/qgit/">qgit</a> to be nicer
and easier to use. It is available on modern linux distros, and
since it is based on Qt, it should run on OSX and Windows.</dd>
<dt><a class="reference external" href="http://www-cs-students.stanford.edu/~blynn/gitmagic/index.html">Git Magic</a> :</dt>
<dd>Another book-size guide that has useful snippets.</dd>
<dt>The <a class="reference external" href="http://learn.github.com">learning center</a> at Github</dt>
<dd>Guides on a number of topics, some specific to github hosting but
much of it of general value.</dd>
<dt>A <a class="reference external" href="http://cworth.org/hgbook-git/tour">port</a> of the Hg book&#8217;s beginning</dt>
<dd>The <a class="reference external" href="http://hgbook.red-bean.com">Mercurial book</a> has a reputation
for clarity, so Carl Worth decided to
<a class="reference external" href="http://cworth.org/hgbook-git/tour">port</a> its introductory
chapter to Git. It&#8217;s a nicely written intro, which is possible in
good measure because of how similar the underlying models of Hg and
Git ultimately are.</dd>
<dt><a class="reference external" href="http://andyjeffries.co.uk/articles/25-tips-for-intermediate-git-users">Intermediate tips</a>: A set</dt>
<dd>of tips that contains some very valuable nuggets, once you&#8217;re past the basics.</dd>
</dl>
</div>
<div class="section" id="for-svn-users">
<h3>For SVN users<a class="headerlink" href="#for-svn-users" title="Permalink to this headline">¶</a></h3>
<p>If you want a bit more background on why the model of version control
used by Git and Mercurial (known as distributed version control) is such
a good idea, I encourage you to read this very well written
<a class="reference external" href="http://www.joelonsoftware.com/items/2010/03/17.html">post</a> by Joel
Spolsky on the topic. After that post, Joel created a very nice
Mercurial tutorial, whose <a class="reference external" href="http://hginit.com/00.html">first page</a>
applies equally well to git and is a very good &#8216;re-education&#8217; for anyone
coming from an SVN (or similar) background.</p>
<p>In practice, I think you are better off following Joel&#8217;s advice and
understanding git on its own merits instead of trying to bang SVN
concepts into git shapes. But for the occasional translation from SVN to
Git of a specific idiom, the <a class="reference external" href="http://git-scm.org/course/svn.html">Git - SVN Crash
Course</a> can be handy.</p>
</div>
<div class="section" id="a-few-useful-tips-for-common-tasks">
<h3>A few useful tips for common tasks<a class="headerlink" href="#a-few-useful-tips-for-common-tasks" title="Permalink to this headline">¶</a></h3>
<div class="section" id="better-shell-support">
<h4>Better shell support<a class="headerlink" href="#better-shell-support" title="Permalink to this headline">¶</a></h4>
<p>Adding git branch info to your bash prompt and tab completion for git
commands and branches is extremely useful. I suggest you at least copy:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash">git-completion.bash</a></li>
<li><a class="reference external" href="https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh">git-prompt.sh</a></li>
</ul>
<p>You can then source both of these files in your <tt class="docutils literal"><span class="pre">~/.bashrc</span></tt> (Linux) or
<tt class="docutils literal"><span class="pre">~/.bash_profile</span></tt> (OSX), and then set your prompt (I&#8217;ll assume you
named them as the originals but starting with a <tt class="docutils literal"><span class="pre">.</span></tt> at the front of
the name):</p>
<div class="highlight-python"><div class="highlight"><pre>source :math:`HOME/.git-completion.bash

source `HOME/.git-prompt.sh

PS1=&#39;[\u@\h \W:math:`(__git_ps1 &quot; (%s)&quot;)]\` &#39;   # adjust this to your prompt liking
</pre></div>
</div>
<p>See the comments in both of those files for lots of extra functionality
they offer.</p>
</div>
<div class="section" id="embedding-git-information-in-latex-documents">
<h4>Embedding Git information in LaTeX documents<a class="headerlink" href="#embedding-git-information-in-latex-documents" title="Permalink to this headline">¶</a></h4>
<p>(Sent by <a class="reference external" href="http://www.onerussian.com">Yaroslav Halchenko</a>)</p>
<p>I use a Make rule:</p>
<div class="highlight-python"><div class="highlight"><pre># Helper if interested in providing proper version tag within the manuscript
revision.tex: ../misc/revision.tex.in ../.git/index
   GITID=$$(git log -1 | grep -e &#39;^commit&#39; -e &#39;^Date:&#39; | sed  -e &#39;s/^[^ ]* *//g&#39; | tr &#39;\n&#39; &#39; &#39;); \
   echo $$GITID; \
   sed -e &quot;s/GITID/$$GITID/g&quot; :math:`&lt; &gt;| `@
</pre></div>
</div>
<p>in the top level <tt class="docutils literal"><span class="pre">Makefile.common</span></tt> which is included in all
subdirectories which actually contain papers (hence all those
<tt class="docutils literal"><span class="pre">../.git</span></tt>). The <tt class="docutils literal"><span class="pre">revision.tex.in</span></tt> file is simply:</p>
<div class="highlight-python"><div class="highlight"><pre>% Embed GIT ID revision and date
\def\revision{GITID}
</pre></div>
</div>
<p>The corresponding <tt class="docutils literal"><span class="pre">paper.pdf</span></tt> depends on <tt class="docutils literal"><span class="pre">revision.tex</span></tt> and includes
the line <tt class="docutils literal"><span class="pre">\input{revision}</span></tt> to load up the actual revision mark.</p>
</div>
<div class="section" id="git-export">
<h4>git export<a class="headerlink" href="#git-export" title="Permalink to this headline">¶</a></h4>
<p>Git doesn&#8217;t have a native export command, but this works just fine:</p>
<div class="highlight-python"><div class="highlight"><pre>git archive --prefix=fperez.org/  master | gzip &gt; ~/tmp/source.tgz
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="git-object-dir" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>When git stores a file in the <tt class="docutils literal"><span class="pre">.git/objects</span></tt> directory,
it does a hash for the file, takes the first two digits of the hash to make
a directory, and then stores a file with a filename from the remaining hash
digits.  For example, when adding a file with hash
<tt class="docutils literal"><span class="pre">d92d079af6a7f276cc8d63dcf2549c03e7deb553</span></tt> git will create
<tt class="docutils literal"><span class="pre">.git/objects/d9</span></tt> directory if it doesn&#8217;t exist, and stores the file
contents as <tt class="docutils literal"><span class="pre">.git/objects/d9/2d079af6a7f276cc8d63dcf2549c03e7deb553</span></tt>.  It
does this so that the number of files in any one directory stay in a
reasonable range.  If git had to store every file, directory listing and
commit in one flat directory, it would soon have a very large number of
files.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The curious coder&#8217;s guide to <tt class="docutils literal"><span class="pre">git</span></tt></a><ul>
<li><a class="reference internal" href="#git-love-hate">git - love - hate</a></li>
<li><a class="reference internal" href="#the-one-thing-about-git-you-really-need-to-understand">The one thing about git you really need to understand</a></li>
<li><a class="reference internal" href="#so-git-is-a-content-manager-so-what">So git is a content manager - so what?</a></li>
<li><a class="reference internal" href="#the-story-so-far">The story so far...</a><ul>
<li><a class="reference internal" href="#the-dog-ate-my-results">The dog ate my results</a></li>
<li><a class="reference internal" href="#deja-vu-all-over-again">Deja vu all over again</a></li>
<li><a class="reference internal" href="#make-regular-snapshots">Make regular snapshots</a></li>
<li><a class="reference internal" href="#reminding-yourself-of-what-you-did">Reminding yourself of what you did</a></li>
<li><a class="reference internal" href="#terminology-breakout">Terminology breakout</a></li>
<li><a class="reference internal" href="#breaking-up-work-into-chunks">Breaking up work into chunks</a></li>
<li><a class="reference internal" href="#the-staging-area">The staging area</a></li>
<li><a class="reference internal" href="#now-the-very-difficult-problem">Now the very difficult problem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cryptographic-hashes-might-be-useful">Cryptographic hashes might be useful</a><ul>
<li><a class="reference internal" href="#a-crazy-idea-use-hash-values-as-file-names">A crazy idea - use hash values as file names</a></li>
<li><a class="reference internal" href="#making-the-directory-listing">Making the directory listing</a></li>
<li><a class="reference internal" href="#the-next-commit-saves-space">The next commit - saves space!</a></li>
<li><a class="reference internal" href="#an-even-more-crazy-idea-hash-the-directory-list">An even more crazy idea - hash the directory list</a></li>
<li><a class="reference internal" href="#even-more-crazy-idea-make-the-whole-commit-into-a-text-file">Even more crazy idea - make the whole commit into a text file</a></li>
<li><a class="reference internal" href="#so-crazy-it-s-actually-git">So crazy it&#8217;s actually git</a></li>
<li><a class="reference internal" href="#linking-the-commits">Linking the commits</a><ul>
<li><a class="reference internal" href="#can-we-completely-get-rid-of-fancy-backups-1-fancy-backups-2">Can we completely get rid of <tt class="docutils literal"><span class="pre">.fancy_backups/1</span></tt>, <tt class="docutils literal"><span class="pre">.fancy_backups/2</span></tt></a><ul>
<li><a class="reference internal" href="#gitting-going-sorry">Gitting going (sorry)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#getting-help">Getting help</a></li>
<li><a class="reference internal" href="#initializing-the-repository">Initializing the repository</a></li>
<li><a class="reference internal" href="#git-add-put-stuff-into-the-staging-area">git add - put stuff into the staging area</a></li>
<li><a class="reference internal" href="#looking-at-real-git-objects">Looking at real git objects</a></li>
<li><a class="reference internal" href="#git-status-showing-the-status-of-files-in-the-working-tree">git status - showing the status of files in the working tree</a></li>
<li><a class="reference internal" href="#staging-the-other-files">Staging the other files</a></li>
<li><a class="reference internal" href="#git-commit-making-the-snapshot">git commit - making the snapshot</a></li>
<li><a class="reference internal" href="#git-log-what-are-the-commits-so-far">git log - what are the commits so far?</a></li>
<li><a class="reference internal" href="#git-branch-which-branch-are-we-on">git branch - which branch are we on?</a></li>
<li><a class="reference internal" href="#git-diff-what-has-changed">git diff - what has changed?</a></li>
<li><a class="reference internal" href="#you-need-to-git-add-a-file-to-put-it-into-the-staging-area">You need to <tt class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></tt> a file to put it into the staging area</a></li>
<li><a class="reference internal" href="#the-cycle-of-git-virtue-work-add-commit-work-add-commit">The cycle of git virtue: work, add, commit, work, add, commit...</a></li>
<li><a class="reference internal" href="#git-updates-the-current-branch-with-the-latest-commit">Git updates the current branch with the latest commit</a></li>
<li><a class="reference internal" href="#a-nicer-log-command-using-git-config">A nicer log command using <tt class="docutils literal"><span class="pre">git</span> <span class="pre">config</span></tt></a></li>
<li><a class="reference internal" href="#git-mv-and-rm-moving-and-removing-files">git mv and rm: moving and removing files</a></li>
<li><a class="reference internal" href="#exercise">Exercise</a></li>
<li><a class="reference internal" href="#git-branch-again-making-a-new-branch">git branch again - making a new branch</a></li>
<li><a class="reference internal" href="#git-head-points-to-the-current-branch">git <tt class="docutils literal"><span class="pre">HEAD</span></tt> points to the current branch</a></li>
<li><a class="reference internal" href="#developing-on-different-branches">Developing on different branches</a></li>
<li><a class="reference internal" href="#git-checkout-set-the-current-branch-set-the-working-tree-from-a-commit">git checkout - set the current branch, set the working tree from a commit</a></li>
<li><a class="reference internal" href="#git-checkout-again-reseting-the-working-tree">git checkout again - reseting the working tree</a></li>
<li><a class="reference internal" href="#git-merge-merging-changes-from-different-branches">git merge - merging changes from different branches</a></li>
<li><a class="reference internal" href="#an-important-aside-conflict-management">An important aside: conflict management</a></li>
</ul>
</li>
<li><a class="reference internal" href="#git-remotes-working-with-other-people-making-backups">git remotes - working with other people, making backups</a><ul>
<li><a class="reference internal" href="#keeping-backups">Keeping backups</a><ul>
<li><a class="reference internal" href="#make-the-empty-backup-repository">Make the empty backup repository</a></li>
<li><a class="reference internal" href="#tell-the-current-git-repository-about-the-backup-repository">Tell the current git repository about the backup repository</a></li>
<li><a class="reference internal" href="#git-push-push-all-data-for-local-branches-to-the-remote">git push – push all data for local branches to the remote</a></li>
<li><a class="reference internal" href="#an-algorithm-for-git-push">An algorithm for git push</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-useful-commands">Other useful commands</a></li>
<li><a class="reference internal" href="#git-resources">Git resources</a></li>
<li><a class="reference internal" href="#introductory-materials">Introductory materials</a></li>
<li><a class="reference internal" href="#beyond-the-basics">Beyond the basics</a></li>
<li><a class="reference internal" href="#for-svn-users">For SVN users</a></li>
<li><a class="reference internal" href="#a-few-useful-tips-for-common-tasks">A few useful tips for common tasks</a><ul>
<li><a class="reference internal" href="#better-shell-support">Better shell support</a></li>
<li><a class="reference internal" href="#embedding-git-information-in-latex-documents">Embedding Git information in LaTeX documents</a></li>
<li><a class="reference internal" href="#git-export">git export</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/curious_git.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="index.html">pydagogue 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, 2010 - Matthew Brett.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>