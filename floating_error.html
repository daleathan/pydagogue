<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Floating point error &mdash; pydagogue 0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pydagogue 0.2 documentation" href="index.html" />
    <link rel="next" title="Bare metal WAF" href="bare_metal_waf.html" />
    <link rel="prev" title="Points on floats" href="floating_point.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="bare_metal_waf.html" title="Bare metal WAF"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="floating_point.html" title="Points on floats"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pydagogue 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="floating-point-error">
<span id="floating-error"></span><h1>Floating point error<a class="headerlink" href="#floating-point-error" title="Permalink to this headline">¶</a></h1>
<p>This page maybe follows from <a class="reference internal" href="floating_point.html#floating-point"><em>Points on floats</em></a></p>
<p>I ran into trouble trying to understand floating point error. After reading
<a class="reference external" href="http://en.wikipedia.org/wiki/Floating_point">Wikipedia floating point</a>, <a class="reference external" href="http://en.wikipedia.org/wiki/Machine_epsilon">Wikipedia machine epsilon</a> and <a class="reference external" href="http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">What every
computer scientist should know about floating point</a>, I felt the need of some
more explanation, and so here it is.</p>
<div class="section" id="units-at-the-last-place">
<h2>Units at the last place<a class="headerlink" href="#units-at-the-last-place" title="Permalink to this headline">¶</a></h2>
<p>Taking the notation from <a class="reference external" href="http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">Every computer scientist</a>; let&#8217;s imagine we have a
floating point number that has base 10 and 3 digits in the significand, say
<span class="math">\(3.14 \times 10^1\)</span>.  Because we only have 3 digits, the nearest larger number
that we can represent is obviously <span class="math">\(3.15 \times 10^1\)</span>.  This number differs from
<span class="math">\(3.14 \times 10^1\)</span> by one unit in the last place (ULP).  Any real number <span class="math">\(z\)</span>
that is between <span class="math">\(3.14 \times 10^1\)</span> and <span class="math">\(3.15 \times 10^1\)</span> can at best be
represented with one of these two numbers.  Let&#8217;s say <span class="math">\(z\)</span> is actually <span class="math">\(\pi\)</span>; now
<span class="math">\(3.1415926...\)</span> is best represented in our numbers as <span class="math">\(3.14 \times 10^1\)</span>, and the
rounding error is <span class="math">\(\pi - 3.14 \times 10^1 = 0.0015926...\)</span>  In the worst case, we
could have some real number <span class="math">\(3.145 \times 10^1\)</span> that will have rounding error
0.005.  If we always choose the floating point number nearest to our real number
<span class="math">\(z\)</span> then the maximum rounding error occurs when <span class="math">\(z\)</span> is halfway between two
representable numbers; in that case the rounding error is 0.5 ULP.</p>
<p>We can generalize to floating point numbers of form:</p>
<div class="math">
\[d_1.d_2...d_p \times \beta^e\]</div>
<p>Where <span class="math">\(p\)</span> is the number of digits in the significand, <span class="math">\(\beta\)</span> is the <em>base</em> (10
in our example), and <span class="math">\(e\)</span> is the exponent.</p>
<p>The number is <em>normalized</em> if <span class="math">\(d_1\)</span> is not zero.</p>
<p>1 ULP corresponds to:</p>
<div class="math">
\[0.00...1 \times \beta^e\]</div>
<p>where there are <span class="math">\(p-1\)</span> zeros in the significand. This is also:</p>
<div class="math">
\[1.0 \times \beta^{e-(p-1)}\]</div>
<p>Note that any normalized floating point number with exponent <span class="math">\(e\)</span> has the same
value for 1 ULP.  Let&#8217;s define:</p>
<div class="math">
\[ulp(e, p) \to \beta^{e-(p-1)}\]</div>
<p>We can represent any real number <span class="math">\(x\)</span> in normalized floating point format by
using an infinite significand:</p>
<div class="math">
\[d_1.d_2... \times \beta^e\]</div>
<p>Again, <em>normalized</em> means that <span class="math">\(d_1 \ne 0\)</span>.  The ULP value for a real value <span class="math">\(x\)</span>
in some some finite floating point format is still <span class="math">\(ulp(e, p)\)</span> where <span class="math">\(p\)</span> is the
number of digits in the significand as above.</p>
</div>
<div class="section" id="absolute-error">
<h2>Absolute error<a class="headerlink" href="#absolute-error" title="Permalink to this headline">¶</a></h2>
<p>The IEEE standard for floating point specifies that the result of any floating
point operation should be correct to within the rounding error of the resulting
number.  That is, it specifies that the maximum rounding error for an individual
operation (add, multiply, subtract, divide) should be 0.5 ULP.</p>
<p>In practice it&#8217;s now very hard indeed to find a machine that does not implement
this rule for floating point operations.</p>
<p>Imagine we have two finite floating point numbers <span class="math">\(q\)</span> and <span class="math">\(r\)</span> and we combine
them using one of the operators {<tt class="docutils literal"><span class="pre">+,</span> <span class="pre">-,</span> <span class="pre">*,</span> <span class="pre">/</span></tt>} in a perfect world at infinite
precision:</p>
<div class="math">
\[x = q \circ r\]</div>
<p>where <span class="math">\(\circ\)</span> is one of the operators {<tt class="docutils literal"><span class="pre">+,</span> <span class="pre">-,</span> <span class="pre">*,</span> <span class="pre">/</span></tt>}. Let&#8217;s call the actual
finite precision number returned from this calculation <span class="math">\(fl(x)\)</span>.  The IEEE
standard specifies that <span class="math">\(fl(x)\)</span> should be the closest number to <span class="math">\(x\)</span> that can be
represented in the finite precision format.</p>
<p>Let <span class="math">\(e\)</span> be the integer exponent of <span class="math">\(x\)</span> in normalized infinite floating point. If
we want to get <span class="math">\(e\)</span> for a particular number <span class="math">\(x\)</span> then we want
<tt class="docutils literal"><span class="pre">flr(logB(abs(x)))</span></tt> where <tt class="docutils literal"><span class="pre">logB</span></tt> is log to whatever base we are using (10 in
our example), and <tt class="docutils literal"><span class="pre">flr(y)</span></tt> gives us the largest integer <tt class="docutils literal"><span class="pre">i</span></tt>, such that <tt class="docutils literal"><span class="pre">i</span>
<span class="pre">&lt;=</span> <span class="pre">y</span></tt>. So, <span class="math">\(flr(1.9) == 1, flr(-1.1) == -2\)</span>.</p>
<p>We remember that <span class="math">\(p\)</span> is the number of digits in the significand in our finite
floating point format. The IEEE rule then becomes:</p>
<div class="math">
\[\left| fl(x) - x \right| \le 0.5 \times ulp(e, p)\]\[\left| fl(x) - x \right| \le 0.5 \times \beta^{e-(p-1)}\]</div>
</div>
<div class="section" id="relative-error">
<h2>Relative error<a class="headerlink" href="#relative-error" title="Permalink to this headline">¶</a></h2>
<p>The <em>relative error</em> is the rounding error divided by the infinite precision
real number <span class="math">\(x\)</span>:</p>
<div class="math">
\[\left| \frac{fl(x) - x}{x} \right| \le \frac{0.5 \times \beta^{e-(p-1)}}{x}\]</div>
<p>However, any value for <span class="math">\(x\)</span> that has some exponent <span class="math">\(e\)</span> has the same value for
<span class="math">\(ulp(e, p) = \beta^{e-(p-1)}\)</span>.  Let <span class="math">\(m\)</span> be the largest digit in base <span class="math">\(\beta\)</span>;
thus <span class="math">\(m = \beta - 1\)</span>.  For example <span class="math">\(m = 9\)</span> in base 10 (<span class="math">\(\beta = 10\)</span>). The values
of <span class="math">\(x\)</span> between <span class="math">\(1.0 \times \beta^e\)</span> and <span class="math">\(m.mmm... \times \beta^e\)</span> all have the
same value for 1 ULP = <span class="math">\(\beta^{e-(p-1)}\)</span>. The <em>relative</em> rounding error will be
greater for smaller <span class="math">\(x\)</span> with the same exponent.  Let:</p>
<div class="math">
\[a = 0.5 \times ulp(e, p).\]\[a = 0.5 \times \beta^{e-(1-p)}\]</div>
<p>Make <span class="math">\(x\)</span> the smallest value with this exponent that has a large rounding error:</p>
<div class="math">
\[x = 1.0 \times \beta^e + a\]</div>
<p>The relative rounding error <span class="math">\(\epsilon\)</span> is:</p>
<div class="math">
\[\epsilon = \frac{a}{\beta^e + a}\]</div>
<p>Because <span class="math">\(a\)</span> is very small compared to <span class="math">\(\beta^e\)</span>:</p>
<div class="math">
\[\epsilon \approx \frac{0.5 \times \beta^{e-(p-1)}}{\beta^e}\]\[\epsilon \approx 0.5 \times \beta^{1-p}\]</div>
<p>Now make <span class="math">\(x\)</span> the largest value with this exponent and that has a large rounding
error:</p>
<div class="math">
\[x = m.mm... \times \beta^e - a\]\[x \approx 1.0 \times \beta^{e+1} - a\]</div>
<p>then:</p>
<div class="math">
\[\epsilon \approx \frac{a}{\beta^{e+1} - a}\]\[\epsilon \approx \frac{0.5 \times \beta^{e-(p-1)}}{\beta^{e+1}}\]\[\epsilon \approx 0.5 \times \beta^{-p}\]</div>
<p>So, the <em>maximum</em> relative error for <span class="math">\(x\)</span> varies (depending on the value of <span class="math">\(x\)</span>)
between <span class="math">\(\approx 0.5 \times \beta^{-p}\)</span> and <span class="math">\(\approx 0.5 \times \beta^{1-p}\)</span>.</p>
<p>Therefore the relative error for any <span class="math">\(x\)</span> (regardless of exponent) is bounded by
the larger of these two maxima:</p>
<div class="math">
\[\epsilon \le 0.5 \times \beta^{1-p}\]</div>
</div>
<div class="section" id="machine-epsilon">
<h2>Machine epsilon<a class="headerlink" href="#machine-epsilon" title="Permalink to this headline">¶</a></h2>
<p>Now note that <span class="math">\(\beta^{1-p}\)</span> is the ULP for 1; that is <span class="math">\(1.0 \times
\beta^{e-(p-1)}\)</span> where <span class="math">\(e\)</span> is 0.  Some people refer to this value as <em>machine
epsilon</em>, others use that term for <span class="math">\(0.5 \times \beta^{1-p}\)</span> - see <a class="reference external" href="http://en.wikipedia.org/wiki/Machine_epsilon#Variant_definitions">variant
definitions</a>.  MATLAB and Octave return <span class="math">\(\beta^{1-p}\)</span> from their <tt class="docutils literal"><span class="pre">eps()</span></tt>
function. <a class="reference external" href="http://numpy.scipy.org">numpy</a> uses the same convention in its <tt class="docutils literal"><span class="pre">np.finfo</span></tt> function.  For
example, the standard <tt class="docutils literal"><span class="pre">float64</span></tt> double precision type in numpy has <span class="math">\(\beta = 2;
p=53\)</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span> <span class="o">==</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">53</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="thanks-to">
<h2>Thanks to<a class="headerlink" href="#thanks-to" title="Permalink to this headline">¶</a></h2>
<p>Stefan van der Walt for several useful suggestions and corrections.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Floating point error</a><ul>
<li><a class="reference internal" href="#units-at-the-last-place">Units at the last place</a></li>
<li><a class="reference internal" href="#absolute-error">Absolute error</a></li>
<li><a class="reference internal" href="#relative-error">Relative error</a></li>
<li><a class="reference internal" href="#machine-epsilon">Machine epsilon</a></li>
<li><a class="reference internal" href="#thanks-to">Thanks to</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="floating_point.html"
                        title="previous chapter">Points on floats</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="bare_metal_waf.html"
                        title="next chapter">Bare metal WAF</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/floating_error.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="bare_metal_waf.html" title="Bare metal WAF"
             >next</a> |</li>
        <li class="right" >
          <a href="floating_point.html" title="Points on floats"
             >previous</a> |</li>
        <li><a href="index.html">pydagogue 0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, 2010 - Matthew Brett.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>