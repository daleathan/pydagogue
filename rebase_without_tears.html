<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Rebase without tears &mdash; pydagogue 0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/traditional.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pydagogue 0.2 documentation" href="index.html" />
    <link rel="up" title="Notes and tutorials on git" href="git.html" />
    <link rel="next" title="Pain in the dots" href="pain_in_dots.html" />
    <link rel="prev" title="Git foundations" href="foundation.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="pain_in_dots.html" title="Pain in the dots"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="foundation.html" title="Git foundations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pydagogue 0.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="git.html" accesskey="U">Notes and tutorials on git</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="rebase-without-tears">
<h1>Rebase without tears<a class="headerlink" href="#rebase-without-tears" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-i-wrote-this-page">
<h2>Why I wrote this page<a class="headerlink" href="#why-i-wrote-this-page" title="Permalink to this headline">¶</a></h2>
<p>I&#8217;m looking at the <a class="reference external" href="http://www.kernel.org/pub/software/scm/git/docs/git-rebase.html">git-rebase man page</a> now.  I may
not be alone in finding it hard to understand, and easy to forget.  I have
twice or three times worked out how it worked, and then forgotten, and wished I
had written something down to explain it to myself.  Here is that explanation.</p>
</div>
<div class="section" id="what-is-this-rebase-of-which-you-speak">
<h2>What is this &#8220;rebase&#8221; of which you speak?<a class="headerlink" href="#what-is-this-rebase-of-which-you-speak" title="Permalink to this headline">¶</a></h2>
<p>Actually it&#8217;s a little difficult to explain.  Rebasing is the process of taking
a fragment of git change history, and rewriting that history as if it had begun
at a different commit.  It&#8217;s easiest to explain by example, and there are some
examples later in this page.  See also the <a class="reference external" href="http://progit.org/book/ch3-6.html">Pro-Git chapter on rebasing</a></p>
</div>
<div class="section" id="your-actual-rebase">
<span id="actual-rebase"></span><h2>Your actual rebase<a class="headerlink" href="#your-actual-rebase" title="Permalink to this headline">¶</a></h2>
<p>I like to think of rebase in its full form, because the full form helps to
remind me of what it is doing.  Here&#8217;s the full form of most rebase commands
<a class="footnote-reference" href="#to-root" id="id1">[1]</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --onto &lt;graft-point&gt; &lt;exclude-from&gt; &lt;include-from&gt;
</pre></div>
</div>
<p>I&#8217;m using different names from the <code class="docutils literal"><span class="pre">git-rebase</span></code> man page - see
<a class="footnote-reference" href="#manpage-names" id="id2">[2]</a>.</p>
<p>The shorter forms use defaults for things you don&#8217;t specify:</p>
<ul class="simple">
<li>If you don&#8217;t specify <code class="docutils literal"><span class="pre">--onto</span></code>, <code class="docutils literal"><span class="pre">&lt;graft-point&gt;</span></code> defaults to
<code class="docutils literal"><span class="pre">&lt;exclude-from&gt;</span></code></li>
<li>If you don&#8217;t specify an <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code> defaults to the
current branch.</li>
</ul>
<div class="section" id="which-commits-will-rebase-apply">
<span id="which-commits"></span><h3>Which commits will rebase apply?<a class="headerlink" href="#which-commits-will-rebase-apply" title="Permalink to this headline">¶</a></h3>
<p>Rebase will apply all the commits found by:</p>
<div class="highlight-python"><div class="highlight"><pre>git log &lt;exclude-from&gt;..&lt;include-from&gt;
</pre></div>
</div>
<p>These are the commits that are reachable from <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code> that are not
reachable from <code class="docutils literal"><span class="pre">&lt;exclude-from&gt;</span></code>.  See <a class="reference internal" href="git_log_dots.html#git-log-two-dots"><span>Logging with two dots</span></a>.</p>
</div>
<div class="section" id="which-branch-does-rebase-modify">
<span id="which-branch"></span><h3>Which branch does rebase modify?<a class="headerlink" href="#which-branch-does-rebase-modify" title="Permalink to this headline">¶</a></h3>
<p>rebase modifies the <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code> branch.  If you don&#8217;t specify
<code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code> it will modify the default for <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code>, that is, the
current branch.</p>
</div>
</div>
<div class="section" id="basic-example">
<span id="id3"></span><h2>Basic example<a class="headerlink" href="#basic-example" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s go through the man page examples.  Here&#8217;s a history tree:</p>
<div class="highlight-python"><div class="highlight"><pre>      A---B---C topic
     /
D---E---F---G master
</pre></div>
</div>
<p>We want to take the novel contents of the <code class="docutils literal"><span class="pre">topic</span></code> branch (<code class="docutils literal"><span class="pre">A,</span> <span class="pre">B,</span> <span class="pre">C</span></code>) and
regraft it so that it starts at the <code class="docutils literal"><span class="pre">master</span></code> branch, like this:</p>
<div class="highlight-python"><div class="highlight"><pre>              A&#39;--B&#39;--C&#39; topic
             /
D---E---F---G master
</pre></div>
</div>
<p>Let&#8217;s do something to ease the explanation, and tag the divergence point <code class="docutils literal"><span class="pre">E</span></code>
thus:</p>
<div class="highlight-python"><div class="highlight"><pre>git tag divergence-point topic~3 # E
</pre></div>
</div>
<p>Obviously that gives us:</p>
<div class="highlight-python"><div class="highlight"><pre>     A---B---C topic
    /
    | F---G master
    |/
D---E  (tag) divergence-point
</pre></div>
</div>
<p>Reading the <a class="reference internal" href="#actual-rebase"><span>Your actual rebase</span></a> command, we suspect the command we want is:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --onto master divergence-point topic
</pre></div>
</div>
<p>And indeed, that does give us what we want.  However we had a to make a tag for
the divergence point, and that was a bit annoying. Can we get away without that?</p>
<p>Yes, because because the meaning of <code class="docutils literal"><span class="pre">&lt;exclude-from&gt;</span> <span class="pre">&lt;include-from&gt;</span></code> above is
to collect the commits that you are going to apply.  See <a class="reference internal" href="#which-commits"><span>Which commits will rebase apply?</span></a>
for an explanation.  The commits wil be those shown by <code class="docutils literal"><span class="pre">git</span> <span class="pre">log</span>
<span class="pre">&lt;exclude-from&gt;..&lt;include-from&gt;</span></code>.  I took the liberty of making a repository to
match the history above.  Here is the result of <code class="docutils literal"><span class="pre">git</span> <span class="pre">log</span> <span class="pre">--oneline</span>
<span class="pre">master..topic</span></code>, before the rebase:</p>
<div class="highlight-python"><div class="highlight"><pre>8de3e90 C
9dcbae2 B
cc3741a A
</pre></div>
</div>
<p>And of course that is the same as <code class="docutils literal"><span class="pre">git</span> <span class="pre">log</span> <span class="pre">--oneline</span> <span class="pre">divergence-point..topic</span></code>.
So we could also do the rebase command with:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --onto master master topic
</pre></div>
</div>
<p>And, in fact, if you don&#8217;t specify the <code class="docutils literal"><span class="pre">--onto</span></code> option, then rebase assumes
you want to graft onto the <code class="docutils literal"><span class="pre">&lt;exclude-from&gt;</span></code> position, so you could also do:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase master topic
</pre></div>
</div>
<p>and in fact, if you don&#8217;t specify the <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code> position, rebase assumes
that you want <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code> to be the state of the current branch, so you
could also do:</p>
<div class="highlight-python"><div class="highlight"><pre>git checkout topic # unless you are on ``topic`` already
git rebase master
</pre></div>
</div>
</div>
<div class="section" id="other-examples">
<h2>Other examples<a class="headerlink" href="#other-examples" title="Permalink to this headline">¶</a></h2>
<p>Here is another example from the <code class="docutils literal"><span class="pre">git-rebase</span></code> man page.  We want to go from
this:</p>
<div class="highlight-python"><div class="highlight"><pre>o---o---o---o---o  master
     \
      o---o---o---o---o  next
                       \
                        o---o---o  topic
</pre></div>
</div>
<p>to this:</p>
<div class="highlight-python"><div class="highlight"><pre>o---o---o---o---o  master
    |            \
    |             o&#39;--o&#39;--o&#39;  topic
     \
      o---o---o---o---o  next
</pre></div>
</div>
<p>How?   Let&#8217;s check the <a class="reference internal" href="#actual-rebase"><span>Your actual rebase</span></a> command.  Maybe it is this:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --onto master next topic
</pre></div>
</div>
<p>Yup, that&#8217;s it!  You understand rebase!</p>
<p>Now we want to go from this:</p>
<div class="highlight-python"><div class="highlight"><pre>                        H---I---J topicB
                       /
              E---F---G  topicA
             /
A---B---C---D  master
</pre></div>
</div>
<p>to this:</p>
<div class="highlight-python"><div class="highlight"><pre>             H&#39;--I&#39;--J&#39;  topicB
            /
            | E---F---G  topicA
            |/
A---B---C---D  master
</pre></div>
</div>
<p>We check the <a class="reference internal" href="#actual-rebase"><span>Your actual rebase</span></a> command.  Could it be this?:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --onto master topicA topicB
</pre></div>
</div>
<p>Could it be anything else?  Congratulations, you are now a rebase master.</p>
</div>
<div class="section" id="safety">
<h2>Safety<a class="headerlink" href="#safety" title="Permalink to this headline">¶</a></h2>
<p>Summary: <strong>always make a new branch before doing a rebase</strong></p>
<p>You&#8217;ll see from <a class="reference internal" href="#which-branch"><span>Which branch does rebase modify?</span></a> that when you a rebase you will change the
branch you are rebasing.  As you remember from the <a class="reference internal" href="#basic-example"><span>Basic example</span></a>, if you
do:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --onto master master topic
</pre></div>
</div>
<p>on this history graph:</p>
<div class="highlight-python"><div class="highlight"><pre>      A---B---C topic
     /
D---E---F---G master
</pre></div>
</div>
<p>then you&#8217;ll get this:</p>
<div class="highlight-python"><div class="highlight"><pre>              A&#39;--B&#39;--C&#39; topic
             /
D---E---F---G master
</pre></div>
</div>
<p>If you only have branches <code class="docutils literal"><span class="pre">master</span></code> and <code class="docutils literal"><span class="pre">topic</span></code> then you have just orphaned
commits <code class="docutils literal"><span class="pre">A,</span> <span class="pre">B,</span> <span class="pre">C</span></code> which will in due course get cleaned out of your repository.
You might want to keep track of where you were before.  You might want to do
that in case you made a mistake and need to retrace your steps.  The easiest way
to do this, is to make a copy of the branch before doing the rebase, like this:</p>
<div class="highlight-python"><div class="highlight"><pre>git branch topic-rebased topic
git rebase --onto master master topic-rebased
</pre></div>
</div>
<p>or, if you are already on <code class="docutils literal"><span class="pre">topic</span></code> and you want to use the shorthand form of
rebase:</p>
<div class="highlight-python"><div class="highlight"><pre>git branch topic-rebased topic
git checkout topic-rebased
git rebase master
</pre></div>
</div>
<p>Now you have left <code class="docutils literal"><span class="pre">topic</span></code> to be a branch that records where you were before:</p>
<div class="highlight-python"><div class="highlight"><pre>              A&#39;--B&#39;--C&#39; topic-rebased
             /
D---E---F---G master
     \
      A---B---C topic
</pre></div>
</div>
<p>If you forget to make a new branch before rebase, and you do need to go back,
then you can use <code class="docutils literal"><span class="pre">git</span> <span class="pre">reflog</span></code>.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="to-root" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><p class="first">I&#8217;ve missed out the <code class="docutils literal"><span class="pre">--interactive</span></code> option, but that doesn&#8217;t
change the logic.  There is one more substantial variation of the
<a class="reference internal" href="#actual-rebase"><span>Your actual rebase</span></a> command, using <code class="docutils literal"><span class="pre">--root</span></code>.  This goes:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --onto &lt;graft-point&gt; --root   &lt;include-from&gt;
</pre></div>
</div>
<p>I&#8217;ve put a couple of extra spaces between <code class="docutils literal"><span class="pre">--root</span></code> and <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code> to
emphasise that <code class="docutils literal"><span class="pre">--root</span></code> is a flag, and <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code> is an argument
with the same meaning as for the normal rebase command.</p>
<p>If you do <code class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">&lt;include-from&gt;</span></code> and then <code class="docutils literal"><span class="pre">git</span> <span class="pre">log</span></code>, you&#8217;ll see all
the commits down to and including the first (root) commit of that branch.
The root commit is a commit without a parent.  The <code class="docutils literal"><span class="pre">--root</span></code> version of the
rebase commands then takes all the commits, from the root commit up until
<code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code>, including the root commit, and grafts them onto
<code class="docutils literal"><span class="pre">&lt;graft-point&gt;</span></code>.</p>
<p>Let&#8217;s say you somehow have two detached histories in your repository:</p>
<div class="highlight-python"><div class="highlight"><pre>A--B--C--D master

X--Y--Z other-branch
</pre></div>
</div>
<p>The root of <code class="docutils literal"><span class="pre">master</span></code> is A, and the root of <code class="docutils literal"><span class="pre">other-branch</span></code> is X.  To
attach these histories you could do:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --onto master --root   other-branch
</pre></div>
</div>
<p>resulting in:</p>
<div class="highlight-python"><div class="highlight"><pre>A--B--C--D master
          \
           X&#39;--Y&#39;--Z&#39; other-branch
</pre></div>
</div>
<p>It would be annoying to have to do the same operation without the <code class="docutils literal"><span class="pre">--root</span></code>
option, because you&#8217;d first have to find the root commit, apply the root
commit, and then rebase the rest of the X-Y-Z history on top of that, rather
like:</p>
<div class="last highlight-python"><div class="highlight"><pre>git tag root-of-other-branch other-branch~2 # tags X commit
git branch tmp-branch master # start rebase at master
git checkout tmp-branch
git cherry-pick root-of-other-branch # apply root commit
git rebase --onto tmp-branch root-of-other-branch other-branch
# You are now on the rebased other-branch
git branch -D tmp-branch
</pre></div>
</div>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="manpage-names" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><p class="first">I&#8217;m using different names for the command options, compared
to the <code class="docutils literal"><span class="pre">git-rebase</span></code> man page.  The man page uses:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">&lt;newbase&gt;</span></code> for my <code class="docutils literal"><span class="pre">&lt;graft-point&gt;</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;upstream&gt;</span></code> for my <code class="docutils literal"><span class="pre">&lt;exclude-from&gt;</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;branch&gt;</span></code> for my <code class="docutils literal"><span class="pre">&lt;include-from&gt;</span></code></li>
</ul>
</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Rebase without tears</a><ul>
<li><a class="reference internal" href="#why-i-wrote-this-page">Why I wrote this page</a></li>
<li><a class="reference internal" href="#what-is-this-rebase-of-which-you-speak">What is this &#8220;rebase&#8221; of which you speak?</a></li>
<li><a class="reference internal" href="#your-actual-rebase">Your actual rebase</a><ul>
<li><a class="reference internal" href="#which-commits-will-rebase-apply">Which commits will rebase apply?</a></li>
<li><a class="reference internal" href="#which-branch-does-rebase-modify">Which branch does rebase modify?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-example">Basic example</a></li>
<li><a class="reference internal" href="#other-examples">Other examples</a></li>
<li><a class="reference internal" href="#safety">Safety</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="foundation.html"
                        title="previous chapter">Git foundations</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pain_in_dots.html"
                        title="next chapter">Pain in the dots</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/rebase_without_tears.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="pain_in_dots.html" title="Pain in the dots"
             >next</a> |</li>
        <li class="right" >
          <a href="foundation.html" title="Git foundations"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pydagogue 0.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="git.html" >Notes and tutorials on git</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2009, 2010 - Matthew Brett.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.2.
    </div>
  </body>
</html>